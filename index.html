<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Ù…Ù†ØµØ© MCRN 360 Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©">
  <meta name="theme-color" content="#0f172a">
  <title>MCRN 360 PRO - Ø§Ù„Ø¨Ø« Ø§Ù„Ø°ÙƒÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <style>
    :root {
      --bg-color: #0f172a;
      --primary-color: #3b82f6;
      --hover-color: #f59e0b;
      --text-color: #e2e8f0;
      --button-color: #1e40af;
      --button-hover: #f97316;
      --gradient-bg: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
      --glass-bg: rgba(15, 23, 42, 0.85);
      --font-family: 'Tajawal', sans-serif;
      --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --ad-primary: #4f46e5;
      --ad-secondary: #10b981;
      --error-color: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
      overflow-x: hidden;
      perspective: 1000px;
    }

    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    nav .logo {
      font-size: clamp(22px, 5vw, 28px);
      font-weight: 900;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .logo .ai-badge {
      background: linear-gradient(135deg, #f59e0b, #ef4444);
      color: white;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 700;
    }

    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }

    .menu-toggle:hover {
      color: var(--hover-color);
      transform: rotate(90deg);
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 16px;
      margin: 0;
      padding: 0;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    nav ul li a {
      color: var(--text-color);
      text-decoration: none;
      font-size: clamp(15px, 4vw, 18px);
      padding: 10px 16px;
      border-radius: 12px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    nav ul li a::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 3px;
      background: var(--hover-color);
      transition: var(--transition);
    }

    nav ul li a:hover, nav ul li a.active {
      color: var(--hover-color);
      background: rgba(245, 158, 11, 0.1);
    }

    nav ul li a:hover::before, nav ul li a.active::before {
      width: 100%;
    }

    .section {
      margin-top: 80px;
      padding: 24px;
      text-align: center;
      display: none;
      max-width: 1600px;
      margin-left: auto;
      margin-right: auto;
      animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #homeSection {
      background: var(--gradient-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-xl);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #homeSection h1 {
      font-size: clamp(28px, 6vw, 42px);
      margin: 24px 0;
      background: linear-gradient(90deg, #f59e0b, #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 900;
      letter-spacing: -1px;
    }

    .stream-container {
      position: relative;
      width: 100%;
      max-width: 1600px;
      margin: 24px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 30px rgba(0, 0, 0, 0.6);
      background: #000;
      transform-style: preserve-3d;
      transition: var(--transition);
    }

    .stream-container:hover {
      transform: translateY(-5px) scale(1.005);
      box-shadow: 0 25px 35px rgba(0, 0, 0, 0.7);
    }

    .stream-container::before {
      content: "";
      display: block;
      padding-top: 56.25%;
    }

    .stream-container .video-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      border-radius: 20px;
    }

    .stream-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 20px;
    }

    .stream-error-message {
      position: absolute;
      top: 20px;
      right: 20px;
      left: 20px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 100;
      animation: slideIn 0.3s ease-out;
      transition: opacity 0.5s ease;
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .ad-container {
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: none;
      position: relative;
    }

    .ad-content {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(135deg, var(--ad-primary), var(--ad-secondary));
      color: white;
    }

    .ad-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .ad-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .ad-description {
      font-size: 1rem;
      margin-bottom: 15px;
      text-align: center;
    }

    .ad-close {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
    }

    .ad-nav {
      display: flex;
      justify-content: center;
      margin-top: 15px;
      gap: 10px;
    }

    .ad-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: var(--transition);
    }

    .ad-dot.active {
      background: white;
      transform: scale(1.2);
    }

    .smart-controls {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 24px 0;
      flex-wrap: wrap;
    }

    .button {
      padding: 12px 24px;
      background: var(--button-color);
      color: var(--text-color);
      border: none;
      border-radius: 12px;
      font-size: clamp(15px, 4vw, 18px);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }

    .button::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
      opacity: 0;
      transition: var(--transition);
    }

    .button:hover {
      background: var(--button-hover);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
    }

    .button:hover::after {
      opacity: 1;
    }

    .button:active {
      transform: translateY(1px) scale(0.98);
    }

    .voice-control-btn {
      background: linear-gradient(135deg, #10b981, #3b82f6);
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: var(--transition);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); }
      100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
    }

    .voice-control-btn:hover {
      transform: scale(1.1);
      background: linear-gradient(135deg, #3b82f6, #10b981);
    }

    .voice-control-btn.listening {
      animation: listening 1.5s infinite;
      background: linear-gradient(135deg, #ef4444, #f59e0b);
    }

    @keyframes listening {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .channels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 16px;
    }

    .channel-card {
      background: rgba(30, 58, 138, 0.3);
      border-radius: 16px;
      padding: 20px;
      transition: var(--transition);
      cursor: pointer;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 180px;
      position: relative;
      overflow: hidden;
    }

    .channel-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        to bottom right,
        rgba(59, 130, 246, 0.1),
        rgba(245, 158, 11, 0.1)
      );
      transform: rotate(45deg);
      z-index: -1;
    }

    .channel-card:hover {
      background: rgba(245, 158, 11, 0.5);
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
    }

    .channel-card h3 {
      color: var(--primary-color);
      font-size: clamp(18px, 5vw, 22px);
      margin: 12px 0;
      font-weight: 700;
    }

    .channel-card .channel-icon {
      font-size: 40px;
      color: var(--hover-color);
      margin-bottom: 10px;
    }

    .channel-card .channel-category {
      background: rgba(15, 23, 42, 0.7);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      margin-top: 8px;
      color: var(--hover-color);
    }

    #adminSection {
      background: rgba(15, 23, 42, 0.9);
      padding: 32px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #adminSection h1 {
      color: var(--primary-color);
      font-size: clamp(26px, 5vw, 36px);
      margin-bottom: 24px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .admin-section {
      background: rgba(255, 255, 255, 0.05);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: var(--transition);
    }

    .admin-section:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-3px);
    }

    .admin-section h2 {
      color: var(--hover-color);
      font-size: clamp(20px, 4vw, 24px);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #channelList .channel-card {
      flex-direction: row;
      justify-content: space-between;
      padding: 16px;
      min-height: auto;
    }

    #adminLogin input, #adminControls input, #adminControls select, #adminControls textarea {
      width: 100%;
      max-width: 400px;
      margin: 12px auto;
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      display: block;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-family: var(--font-family);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: var(--transition);
    }

    #adminLogin input:focus, #adminControls input:focus, #adminControls select:focus, #adminControls textarea:focus {
      outline: none;
      border-color: var(--hover-color);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
      background: rgba(255, 255, 255, 0.15);
    }

    #channelSearch, #filterCategory, #adSearch, #filterAdType {
      width: 48%;
      padding: 12px 16px;
      margin: 12px 1%;
      border-radius: 12px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-family: var(--font-family);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    footer {
      margin-top: auto;
      text-align: center;
      padding: 20px;
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      font-size: clamp(13px, 3vw, 15px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    footer p {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      background: rgba(59, 130, 246, 0.5);
      border-radius: 50%;
      pointer-events: none;
    }

    /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨ Ø§Ù„Ø°ÙƒÙŠ */
    @media (max-width: 1200px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
      
      .ad-container {
        max-width: 900px;
      }
    }

    @media (max-width: 992px) {
      .section {
        padding: 20px;
      }
      
      .smart-controls {
        gap: 12px;
      }
      
      .ad-image {
        max-height: 250px;
      }
    }

    @media (max-width: 768px) {
      nav {
        padding: 10px 16px;
      }
      
      .section {
        padding: 16px;
        margin-top: 70px;
      }
      
      .smart-controls {
        gap: 10px;
      }
      
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
      
      #channelSearch, #filterCategory, #adSearch, #filterAdType {
        width: 100%;
        margin: 8px 0;
      }
      
      .ad-title {
        font-size: 1.3rem;
      }
      
      .ad-description {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 600px) {
      .menu-toggle {
        display: block;
      }
      
      nav ul {
        position: absolute;
        top: 70px;
        right: 16px;
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        flex-direction: column;
        width: 250px;
        max-height: 0;
        overflow: hidden;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      nav ul.show {
        max-height: 500px;
        padding: 16px;
      }
      
      nav ul li a {
        padding: 12px;
        justify-content: center;
      }
      
      .channels-grid {
        grid-template-columns: 1fr;
      }
      
      .voice-control-btn {
        width: 50px;
        height: 50px;
        bottom: 20px;
        left: 20px;
      }
      
      .ad-image {
        max-height: 200px;
      }
      
      .ad-title {
        font-size: 1.1rem;
      }
    }

    .glow {
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
    }

    .rotate {
      animation: rotate 10s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .progress-container {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1001;
      display: none;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #f59e0b);
      width: 0%;
      transition: width 0.3s ease;
    }

    .welcome-notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, var(--ad-primary), var(--ad-secondary));
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 350px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .welcome-notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .welcome-notification .close-welcome {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-right: -5px;
      margin-left: 10px;
    }

    @media (max-width: 768px) {
      .welcome-notification {
        bottom: 80px;
        right: 15px;
        left: 15px;
        max-width: none;
      }
    }

    .face-recognition-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.5);
    }

    .face-recognition-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .face-recognition-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .face-recognition-message {
      position: absolute;
      bottom: 10px;
      left: 0;
      right: 0;
      text-align: center;
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 4px;
    }

    .face-landmark {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #3b82f6;
      border-radius: 50%;
      transform: translate(-2px, -2px);
    }

    .face-box {
      position: absolute;
      border: 2px solid #f59e0b;
      border-radius: 4px;
    }

    /* Ø£Ù†Ù…Ø§Ø· Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¯Ø¹Ù… 4K */
    .quality-selector {
      position: absolute;
      bottom: 60px;
      right: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 8px;
      padding: 8px;
      display: none;
    }

    .quality-btn {
      display: block;
      color: white;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      margin: 4px 0;
      text-align: right;
    }

    .quality-btn:hover, .quality-btn.active {
      background: var(--primary-color);
    }

    .vjs-quality-selector {
      position: relative;
    }

    .vjs-quality-selector .vjs-menu-button {
      margin: 0;
      padding: 0;
    }

    .vjs-quality-selector .vjs-icon-placeholder:before {
      content: "4K";
      font-family: VideoJS;
      font-weight: normal;
      font-style: normal;
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ 4K */
    @media (min-width: 1920px) {
      .stream-container {
        max-width: 2560px;
      }
      
      .section {
        max-width: 2560px;
      }
      
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      }
      
      .channel-card {
        min-height: 250px;
      }
      
      .channel-card h3 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <nav>
    <div class="logo">
      <i class="fas fa-satellite-dish rotate"></i> MCRN 360 <span class="ai-badge">AI</span>
    </div>
    <button class="menu-toggle" id="toggleMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
    <ul id="navList">
      <li><a href="#" id="linkHome" class="active"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a href="#" id="linkAllChannels"><i class="fas fa-tv"></i> Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</a></li>
      <li><a href="#" id="linkNewsChannels"><i class="fas fa-newspaper"></i> Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©</a></li>
      <li><a href="#" id="linkSportsChannels"><i class="fas fa-football-ball"></i> Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©</a></li>
      <li><a href="#" id="linkChildrenChannels"><i class="fas fa-child"></i> Ø§Ù„Ø£Ø·ÙØ§Ù„</a></li>
      <li><a href="#" id="linkAdmin"><i class="fas fa-cogs"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
    </ul>
  </nav>

  <div id="homeSection" class="section active">
    <h1 class="glow">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ <span>MCRN 360 PRO</span></h1>
    
    <div class="ad-container" id="adContainer">
      <button class="ad-close" id="adCloseBtn"><i class="fas fa-times"></i></button>
      <div class="ad-content" id="adContent">
        <img class="ad-image" id="adImage" src="" alt="Ø¥Ø¹Ù„Ø§Ù†">
        <h3 class="ad-title" id="adTitle"></h3>
        <p class="ad-description" id="adDescription"></p>
        <div class="ad-nav" id="adNav"></div>
      </div>
    </div>
    
    <div class="stream-container" id="streamContainer">
      <video id="videoPlayer" class="video-js vjs-big-play-centered vjs-16-9" controls preload="auto" muted playsinline>
        <source src="" type="video/mp4" />
        <p class="vjs-no-js">
          Ù„Ø±Ø¤ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ ÙŠØ±Ø¬Ù‰ ØªÙ…ÙƒÙŠÙ† JavaScript Ø£Ùˆ ØªØ±Ù‚ÙŠØ© Ù…ØªØµÙØ­Ùƒ Ø¥Ù„Ù‰ Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… HTML5 video
        </p>
      </video>
      <iframe id="streamIframe" src="" scrolling="auto" allowfullscreen="true" style="display: none;"></iframe>
    </div>
    <div class="smart-controls" id="videoControls">
      <button class="button" id="rewindBtn"><i class="fas fa-backward"></i> Ø±Ø¬ÙˆØ¹ 10 Ø«ÙˆØ§Ù†ÙŠ</button>
      <button class="button" id="playPauseBtn"><i class="fas fa-play"></i> ØªØ´ØºÙŠÙ„</button>
      <button class="button" id="forwardBtn"><i class="fas fa-forward"></i> ØªÙ‚Ø¯Ù… 10 Ø«ÙˆØ§Ù†ÙŠ</button>
      <button class="button" id="fullscreenBtn"><i class="fas fa-expand"></i> Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
      <button class="button" id="volumeBtn"><i class="fas fa-volume-up"></i> Ø§Ù„ØµÙˆØª</button>
      <button class="button" id="qualityBtn"><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¬ÙˆØ¯Ø©</button>
    </div>
    <h2><i class="fas fa-list"></i> Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©:</h2>
    <div class="smart-controls" id="channelButtons"></div>
  </div>

  <div id="allChannelsSection" class="section">
    <h1><i class="fas fa-tv"></i> Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h1>
    <div class="channels-grid" id="allChannelsGrid"></div>
  </div>
  <div id="newsChannelsSection" class="section">
    <h1><i class="fas fa-newspaper"></i> Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©</h1>
    <div class="channels-grid" id="newsChannelsGrid"></div>
  </div>
  <div id="sportsChannelsSection" class="section">
    <h1><i class="fas fa-football-ball"></i> Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©</h1>
    <div class="channels-grid" id="sportsChannelsGrid"></div>
  </div>
  <div id="childrenChannelsSection" class="section">
    <h1><i class="fas fa-child"></i> Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„</h1>
    <div class="channels-grid" id="childrenChannelsGrid"></div>
  </div>

  <div id="adminSection" class="section">
    <h1><i class="fas fa-user-shield"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠØ©</h1>
    <div id="adminLogin">
      <input type="password" id="adminPassword" placeholder="ğŸ”’ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin: 12px 0;">
        <label style="cursor: pointer;"><input type="checkbox" id="rememberMe"> ØªØ°ÙƒØ±Ù†ÙŠ</label>
        <button class="button" id="faceLoginBtn"><i class="fas fa-user-check"></i> Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡</button>
      </div>
      <button class="button" id="loginBtn"><i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div id="adminControls" style="display: none;">
      <div class="admin-section">
        <h2><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <input type="text" id="channelName" placeholder="ğŸ“º Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©" required>
        <input type="url" id="channelSrc" placeholder="ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«" required>
        <select id="channelType">
          <option value="video">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ</option>
          <option value="iframe">ğŸ–¼ï¸ Ø¥Ø·Ø§Ø±</option>
          <option value="youtube">â–¶ï¸ ÙŠÙˆØªÙŠÙˆØ¨</option>
          <option value="m3u8">ğŸ“¡ M3U8</option>
          <option value="ahmad">ğŸ“º Ø³ÙŠØ±ÙØ± Ø§Ù„Ø£Ø­Ù…Ø¯</option>
          <option value="vk">ğŸ”´ VK</option>
        </select>
        <select id="channelCategory">
          <option value="general">ğŸŒ Ø¹Ø§Ù…</option>
          <option value="news">ğŸ“° Ø¥Ø®Ø¨Ø§Ø±ÙŠ</option>
          <option value="sports">âš½ Ø±ÙŠØ§Ø¶ÙŠ</option>
          <option value="children">ğŸ§¸ Ø£Ø·ÙØ§Ù„</option>
        </select>
        <button class="button" id="addChannelBtn"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø©</button>
      </div>
      <div class="admin-section">
        <h2><i class="fas fa-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
          <input type="text" id="channelSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©...">
          <select id="filterCategory">
            <option value="">ğŸ“‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
            <option value="general">ğŸŒ Ø¹Ø§Ù…</option>
            <option value="news">ğŸ“° Ø¥Ø®Ø¨Ø§Ø±ÙŠ</option>
            <option value="sports">âš½ Ø±ÙŠØ§Ø¶ÙŠ</option>
            <option value="children">ğŸ§¸ Ø£Ø·ÙØ§Ù„</option>
          </select>
        </div>
        <div id="channelList" class="channels-grid"></div>
      </div>
      
      <div class="admin-section">
        <h2><i class="fas fa-ad"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
          <input type="text" id="adSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†...">
          <select id="filterAdType">
            <option value="">ğŸ“‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
            <option value="image">ğŸ–¼ï¸ ØµÙˆØ±Ø©</option>
            <option value="video">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ</option>
            <option value="text">ğŸ“ Ù†ØµÙŠ</option>
          </select>
        </div>
        <div id="adList" class="channels-grid"></div>
      </div>
      
      <div class="admin-section">
        <h2><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="adTitleInput" placeholder="ğŸ“Œ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" required>
        <textarea id="adDescriptionInput" placeholder="ğŸ“ ÙˆØµÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" rows="3"></textarea>
        <input type="url" id="adImageInput" placeholder="ğŸ–¼ï¸ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <input type="url" id="adVideoInput" placeholder="ğŸ¥ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <input type="url" id="adLinkInput" placeholder="ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <select id="adType">
          <option value="image">ğŸ–¼ï¸ Ø¥Ø¹Ù„Ø§Ù† ØµÙˆØ±ÙŠ</option>
          <option value="video">ğŸ¥ Ø¥Ø¹Ù„Ø§Ù† ÙÙŠØ¯ÙŠÙˆ</option>
          <option value="text">ğŸ“ Ø¥Ø¹Ù„Ø§Ù† Ù†ØµÙŠ</option>
        </select>
        <button class="button" id="addAdBtn"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
      </div>
      
      <div class="admin-section">
        <h2><i class="fas fa-bell"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 15px;">
          <input type="text" id="notificationTitle" placeholder="ğŸ“Œ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±" style="flex: 1;">
          <textarea id="notificationMessage" placeholder="ğŸ“ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±" rows="2" style="width: 100%;"></textarea>
          <select id="notificationType" style="flex: 1;">
            <option value="info">â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ</option>
            <option value="success">âœ… Ù†Ø¬Ø§Ø­</option>
            <option value="warning">âš ï¸ ØªØ­Ø°ÙŠØ±</option>
            <option value="error">âŒ Ø®Ø·Ø£</option>
          </select>
        </div>
        <button class="button" id="sendNotificationBtn"><i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±</button>
        <button class="button" id="toggleWelcomeBtn"><i class="fas fa-comment"></i> ØªØ¨Ø¯ÙŠÙ„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ±Ø­ÙŠØ¨</button>
      </div>
      
      <button class="button" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <div class="voice-control-btn" id="voiceControlBtn" title="Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµÙˆØªÙŠ">
    <i class="fas fa-microphone"></i>
  </div>

  <div class="particles" id="particles"></div>

  <div class="welcome-notification" id="welcomeNotification">
    <i class="fas fa-hand-wave"></i>
    <div>
      <strong>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ MCRN 360 PRO!</strong>
      <p>Ø§Ø³ØªÙ…ØªØ¹ Ø¨ØªØ¬Ø±Ø¨Ø© Ù…Ø´Ø§Ù‡Ø¯Ø© ÙØ±ÙŠØ¯Ø© Ù…Ø¹ Ø£Ø­Ø¯Ø« Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙˆØ§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©.</p>
    </div>
    <button class="close-welcome" id="closeWelcomeBtn"><i class="fas fa-times"></i></button>
  </div>

  <footer>
    <p><i class="fas fa-copyright"></i> 2026 MCRN 360 PRO. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©. <span id="aiStatus" style="color: #10b981;"><i class="fas fa-circle"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù†Ø´Ø·</span></p>
  </footer>

  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  
  <script>
    // =============================================
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ù…Ø¹ Ø¯Ø¹Ù… HLS Ùˆ DASH
    // =============================================
    const player = videojs('videoPlayer', {
      fluid: true,
      responsive: true,
      controls: true,
      playbackRates: [0.25, 0.5, 1, 1.5, 2, 3],
      userActions: {
        hotkeys: true,
        doubleClick: true
      },
      html5: {
        vhs: {
          overrideNative: true,
          enableLowInitialPlaylist: true,
          smoothQualityChange: true,
          useDevicePixelRatio: true
        }
      }
    });

    // =============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†
    // =============================================
    class DataManager {
      constructor() {
        this.loadData();
      }
      
      loadData() {
        this.channelsData = JSON.parse(localStorage.getItem('channelsData')) || this.getDefaultChannels();
        this.adsData = JSON.parse(localStorage.getItem('adsData')) || this.getDefaultAds();
        this.systemSettings = JSON.parse(localStorage.getItem('systemSettings')) || this.getDefaultSettings();
      }
      
      saveData() {
        localStorage.setItem('channelsData', JSON.stringify(this.channelsData));
        localStorage.setItem('adsData', JSON.stringify(this.adsData));
        localStorage.setItem('systemSettings', JSON.stringify(this.systemSettings));
      }
      
      getDefaultChannels() {
        return {
          1: { 
            type: 'video', 
            src: 'https://vjs.zencdn.net/v/oceans.mp4', 
            category: 'general', 
            name: 'Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©',
            thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=MCRN+Demo'
          },
          2: { 
            type: 'ahmad', 
            src: 'mbc1', 
            category: 'general', 
            name: 'MBC 1',
            thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=MBC1'
          },
          3: { 
            type: 'youtube', 
            src: 'UCYJdpnjuSWVOLgGT9fIzL0g', 
            category: 'general', 
            name: 'Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨',
            thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=YouTube'
          },
          4: { 
            type: 'm3u8', 
            src: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8', 
            category: 'general', 
            name: 'Ù‚Ù†Ø§Ø© M3U8',
            thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=M3U8'
          },
          5: { 
            type: 'vk', 
            src: '791768803_456255634', 
            category: 'general', 
            name: 'Ù‚Ù†Ø§Ø© VK',
            thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=VK'
          }
        };
      }
      
      getDefaultAds() {
        return [
          {
            id: 1,
            title: "Ø¹Ø±Ø¶ Ø®Ø§Øµ!",
            description: "Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®ØµÙ… 30% Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙÙ‚Ø·",
            image: "https://via.placeholder.com/600x300/4f46e5/ffffff?text=Special+Offer",
            link: "#",
            type: "image",
            active: true
          },
          {
            id: 2,
            title: "ØªØ·Ø¨ÙŠÙ‚Ù†Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
            description: "Ø­Ù…Ù„ ØªØ·Ø¨ÙŠÙ‚ MCRN 360 Ø§Ù„Ø¢Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø± Ù…Ø¬Ø§Ù†ÙŠ",
            image: "https://via.placeholder.com/600x300/10b981/ffffff?text=New+App",
            link: "#",
            type: "image",
            active: true
          }
        ];
      }
      
      getDefaultSettings() {
        return {
          showWelcomeNotification: true,
          adsInterval: 30,
          lastAdShownTime: 0,
          faceRecognitionEnabled: true,
          adminFaces: [],
          adminPassword: '77177'
        };
      }
    }

    // =============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª ÙˆØ§Ù„Ø¨Ø«
    // =============================================
    class StreamManager {
      constructor(dataManager) {
        this.dataManager = dataManager;
        this.currentHls = null;
        this.currentDash = null;
        this.currentAdIndex = 0;
        this.adInterval = null;
        
        this.initElements();
        this.initEventListeners();
      }
      
      initElements() {
        this.streamContainer = document.getElementById('streamContainer');
        this.videoElement = document.getElementById('videoPlayer');
        this.iframeElement = document.getElementById('streamIframe');
        this.progressContainer = document.getElementById('progressContainer');
        this.progressBar = document.getElementById('progressBar');
        this.adContainer = document.getElementById('adContainer');
        this.adCloseBtn = document.getElementById('adCloseBtn');
        this.adContent = document.getElementById('adContent');
        this.adImage = document.getElementById('adImage');
        this.adTitle = document.getElementById('adTitle');
        this.adDescription = document.getElementById('adDescription');
        this.adNav = document.getElementById('adNav');
      }
      
      initEventListeners() {
        this.adCloseBtn.addEventListener('click', () => {
          this.adContainer.style.display = 'none';
        });
        
        document.getElementById('rewindBtn').addEventListener('click', () => {
          player.currentTime(player.currentTime() - 10);
          this.showFeedback('Ø±Ø¬ÙˆØ¹ 10 Ø«ÙˆØ§Ù†ÙŠ');
        });
        
        document.getElementById('playPauseBtn').addEventListener('click', () => {
          if (player.paused()) {
            player.play();
            document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù';
            this.showFeedback('ØªØ´ØºÙŠÙ„');
          } else {
            player.pause();
            document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i> ØªØ´ØºÙŠÙ„';
            this.showFeedback('Ø¥ÙŠÙ‚Ø§Ù');
          }
        });
        
        document.getElementById('forwardBtn').addEventListener('click', () => {
          player.currentTime(player.currentTime() + 10);
          this.showFeedback('ØªÙ‚Ø¯Ù… 10 Ø«ÙˆØ§Ù†ÙŠ');
        });
        
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
          if (player.isFullscreen()) {
            player.exitFullscreen();
            this.showFeedback('Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
          } else {
            player.requestFullscreen();
            this.showFeedback('Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
          }
        });
        
        document.getElementById('volumeBtn').addEventListener('click', () => {
          if (player.muted()) {
            player.muted(false);
            document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-up"></i> ÙƒØªÙ…';
            this.showFeedback('Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙˆØª');
          } else {
            player.muted(true);
            document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-mute"></i> ÙÙƒ Ø§Ù„ÙƒØªÙ…';
            this.showFeedback('ÙƒØªÙ… Ø§Ù„ØµÙˆØª');
          }
        });
      }
      
      loadChannel(channelNum) {
        this.showProgressBar();
        const channel = this.dataManager.channelsData[channelNum] || this.dataManager.channelsData[1];
        
        this.videoElement.style.display = 'none';
        this.iframeElement.style.display = 'none';
        this.adContainer.style.display = 'none';
        
        document.querySelectorAll('.stream-error-message').forEach(el => el.remove());
        
        // ØªÙ†Ø¸ÙŠÙ Ù…Ø´ØºÙ„Ø§Øª HLS/DASH Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        if (this.currentHls) {
          this.currentHls.destroy();
          this.currentHls = null;
        }
        if (this.currentDash) {
          this.currentDash.reset();
          this.currentDash = null;
        }
        
        try {
          if (channel.type === 'video') {
            this.videoElement.style.display = 'block';
            player.src({ src: channel.src, type: 'video/mp4' });
            player.poster(channel.thumb || '');
            
            player.ready(() => {
              player.play().catch(err => {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ:', err);
                this.handlePlaybackError(channel);
              });
            });
            
            player.on('error', () => {
              this.handlePlaybackError(channel);
            });
          } 
          else if (channel.type === 'iframe') {
            this.iframeElement.style.display = 'block';
            this.iframeElement.src = channel.src;
            
            this.iframeElement.onerror = () => {
              this.handlePlaybackError(channel);
            };
            
            this.iframeElement.onload = () => {
              try {
                if (this.iframeElement.contentDocument && this.iframeElement.contentDocument.title) {
                  this.hideProgressBar();
                } else {
                  this.handlePlaybackError(channel);
                }
              } catch (e) {
                this.hideProgressBar();
              }
            };
          }
          else if (channel.type === 'youtube') {
            this.iframeElement.style.display = 'block';
            const youtubeSrc = `https://www.youtube.com/embed/live_stream?channel=${channel.src}`;
            this.iframeElement.src = youtubeSrc;
            
            this.iframeElement.onerror = () => {
              this.handlePlaybackError(channel);
            };
            
            this.iframeElement.onload = () => {
              this.hideProgressBar();
            };
          }
          else if (channel.type === 'm3u8') {
            this.videoElement.style.display = 'block';
            if (Hls.isSupported()) {
              this.currentHls = new Hls();
              this.currentHls.loadSource(channel.src);
              this.currentHls.attachMedia(this.videoElement);
              this.currentHls.on(Hls.Events.MANIFEST_PARSED, () => {
                player.play().catch(err => {
                  console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ HLS:', err);
                  this.handlePlaybackError(channel);
                });
              });
              this.currentHls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                  this.handlePlaybackError(channel);
                }
              });
            } else if (this.videoElement.canPlayType('application/vnd.apple.mpegurl')) {
              this.videoElement.src = channel.src;
              this.videoElement.addEventListener('loadedmetadata', () => {
                this.videoElement.play().catch(err => {
                  console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ HLS:', err);
                  this.handlePlaybackError(channel);
                });
              });
            } else {
              this.handlePlaybackError(channel);
            }
          }
          else if (channel.type === 'ahmad') {
            this.iframeElement.style.display = 'block';
            const ahmadSrc = `https://www.elahmad.com/tv/live/shaka.php?id=${channel.src}`;
            this.iframeElement.src = ahmadSrc;
            
            this.iframeElement.onerror = () => {
              this.handlePlaybackError(channel);
            };
            
            this.iframeElement.onload = () => {
              this.hideProgressBar();
            };
          }
          else if (channel.type === 'vk') {
            this.iframeElement.style.display = 'block';
            const vkSrc = `https://vk.com/video_ext.php?oid=-${channel.src.split('_')[0]}&id=${channel.src.split('_')[1]}&hash=` + Math.random().toString(36).substring(7);
            this.iframeElement.src = vkSrc;
            
            this.iframeElement.onerror = () => {
              this.handlePlaybackError(channel);
            };
            
            this.iframeElement.onload = () => {
              this.hideProgressBar();
            };
          }
          
          localStorage.setItem('lastWatched', channelNum);
          document.querySelectorAll('.channel-btn').forEach(btn => btn.classList.remove('active'));
          document.getElementById(`channelBtn-${channelNum}`)?.classList.add('active');
          this.analyzeViewingHabits(channelNum);
          this.startAdCycle();
          
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©:', error);
          this.handlePlaybackError(channel);
        }
      }
      
      handlePlaybackError(channel) {
        this.hideProgressBar();
        console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©: ${channel.name}`);
        
        const alternativeChannel = this.findAlternativeChannel(channel);
        
        if (alternativeChannel) {
          const errorMessage = document.createElement('div');
          errorMessage.className = 'stream-error-message';
          errorMessage.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            <span>Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ø¥Ù„Ù‰ Ù‚Ù†Ø§Ø© Ø¨Ø¯ÙŠÙ„Ø© Ø¨Ø³Ø¨Ø¨ Ù…Ø´ÙƒÙ„Ø© ØªÙ‚Ù†ÙŠØ©</span>
          `;
          this.streamContainer.prepend(errorMessage);
          
          setTimeout(() => {
            errorMessage.style.opacity = '0';
            setTimeout(() => errorMessage.remove(), 500);
          }, 5000);
          
          this.loadChannel(alternativeChannel);
        } else {
          player.poster('https://via.placeholder.com/800x450/1e293b/ffffff?text=Ø®Ø·Ø£+ÙÙŠ+Ø§Ù„Ø§ØªØµØ§Ù„');
          player.createModal(`
            <div style="text-align:center;padding:20px;">
              <i class="fas fa-exclamation-triangle" style="font-size:3em;color:#f59e0b;"></i>
              <h3 style="margin-top:15px;">ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù‚Ù†Ø§Ø©</h3>
              <p style="margin:15px 0;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ ØªØ¬Ø±Ø¨Ø© Ù‚Ù†Ø§Ø© Ø£Ø®Ø±Ù‰</p>
              <button onclick="window.location.reload()" style="
                background: #3b82f6;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
              ">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            </div>
          `);
        }
      }
      
      findAlternativeChannel(currentChannel) {
        for (const [num, channel] of Object.entries(this.dataManager.channelsData)) {
          if (channel.category === currentChannel.category && num !== currentChannel.num && channel.src !== currentChannel.src) {
            return num;
          }
        }
        return null;
      }
      
      startAdCycle() {
        if (this.adInterval) clearInterval(this.adInterval);
        
        const activeAds = this.dataManager.adsData.filter(ad => ad.active);
        if (activeAds.length === 0) return;
        
        this.showAd(this.currentAdIndex);
        
        this.adInterval = setInterval(() => {
          this.currentAdIndex = (this.currentAdIndex + 1) % activeAds.length;
          this.showAd(this.currentAdIndex);
        }, this.dataManager.systemSettings.adsInterval * 60 * 1000);
      }
      
      showAd(index) {
        const activeAds = this.dataManager.adsData.filter(ad => ad.active);
        if (index >= activeAds.length) return;
        
        const ad = activeAds[index];
        
        this.adTitle.textContent = ad.title;
        this.adDescription.textContent = ad.description;
        
        if (ad.image) {
          this.adImage.src = ad.image;
          this.adImage.style.display = 'block';
        } else {
          this.adImage.style.display = 'none';
        }
        
        this.updateAdNav(activeAds.length, index);
        this.adContainer.style.display = 'block';
        this.dataManager.systemSettings.lastAdShownTime = Date.now();
        this.dataManager.saveData();
      }
      
      updateAdNav(totalAds, currentIndex) {
        this.adNav.innerHTML = '';
        
        for (let i = 0; i < totalAds; i++) {
          const dot = document.createElement('div');
          dot.classList.add('ad-dot');
          if (i === currentIndex) dot.classList.add('active');
          dot.addEventListener('click', () => {
            this.currentAdIndex = i;
            this.showAd(this.currentAdIndex);
          });
          this.adNav.appendChild(dot);
        }
      }
      
      analyzeViewingHabits(channelNum) {
        const channel = this.dataManager.channelsData[channelNum];
        if (!channel) return;
        
        console.log(`ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©: ${channel.name} (${channel.category})`);
        channel.views = (channel.views || 0) + 1;
        this.dataManager.saveData();
      }
      
      showProgressBar() {
        this.progressContainer.style.display = 'block';
        let width = 0;
        const interval = setInterval(() => {
          if (width >= 90) {
            clearInterval(interval);
          } else {
            width += 5;
            this.progressBar.style.width = `${width}%`;
          }
        }, 100);
      }
      
      hideProgressBar() {
        this.progressBar.style.width = '100%';
        setTimeout(() => {
          this.progressContainer.style.display = 'none';
          this.progressBar.style.width = '0%';
        }, 300);
      }
      
      showFeedback(message) {
        const feedback = document.createElement('div');
        feedback.className = 'feedback-message';
        feedback.textContent = message;
        feedback.style.position = 'fixed';
        feedback.style.bottom = '100px';
        feedback.style.left = '50%';
        feedback.style.transform = 'translateX(-50%)';
        feedback.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
        feedback.style.color = 'white';
        feedback.style.padding = '10px 20px';
        feedback.style.borderRadius = '20px';
        feedback.style.zIndex = '10000';
        feedback.style.animation = 'fadeInOut 2s ease-in-out';
        
        document.body.appendChild(feedback);
        
        setTimeout(() => {
          feedback.remove();
        }, 2000);
      }
    }

    // =============================================
    // Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    // =============================================
    class UIManager {
      constructor(dataManager, streamManager) {
        this.dataManager = dataManager;
        this.streamManager = streamManager;
        
        this.initElements();
        this.initEventListeners();
        this.renderChannels();
        this.manageWelcomeNotification();
      }
      
      initElements() {
        this.sections = {
          home: document.getElementById('homeSection'),
          allChannels: document.getElementById('allChannelsSection'),
          newsChannels: document.getElementById('newsChannelsSection'),
          sportsChannels: document.getElementById('sportsChannelsSection'),
          childrenChannels: document.getElementById('childrenChannelsSection'),
          admin: document.getElementById('adminSection')
        };
        
        this.channelButtons = document.getElementById('channelButtons');
        this.allChannelsGrid = document.getElementById('allChannelsGrid');
        this.newsChannelsGrid = document.getElementById('newsChannelsGrid');
        this.sportsChannelsGrid = document.getElementById('sportsChannelsGrid');
        this.childrenChannelsGrid = document.getElementById('childrenChannelsGrid');
        this.channelList = document.getElementById('channelList');
        this.adList = document.getElementById('adList');
        this.welcomeNotification = document.getElementById('welcomeNotification');
        this.closeWelcomeBtn = document.getElementById('closeWelcomeBtn');
      }
      
      initEventListeners() {
        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        ['linkHome', 'linkAllChannels', 'linkNewsChannels', 'linkSportsChannels', 'linkChildrenChannels', 'linkAdmin'].forEach(id => {
          document.getElementById(id).addEventListener('click', (e) => {
            e.preventDefault();
            const sectionKey = id === 'linkAdmin' ? 'admin' : id.replace('link', '').toLowerCase();
            this.showSection(sectionKey, id);
          });
        });
        
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ†Ù‚Ù„ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
        document.getElementById('toggleMenuBtn').addEventListener('click', () => {
          document.getElementById('navList').classList.toggle('show');
        });
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ±Ø­ÙŠØ¨
        this.closeWelcomeBtn.addEventListener('click', () => {
          this.welcomeNotification.classList.remove('show');
        });
      }
      
      showSection(sectionKey, linkId) {
        Object.values(this.sections).forEach(section => section.classList.remove('active'));
        this.sections[sectionKey].classList.add('active');
        document.querySelectorAll('nav ul li a').forEach(a => a.classList.remove('active'));
        if (linkId) document.getElementById(linkId).classList.add('active');
        if (window.innerWidth <= 600) document.getElementById('navList').classList.remove('show');
        
        if (sectionKey === 'admin') {
          const adminLogin = document.getElementById('adminLogin');
          const adminControls = document.getElementById('adminControls');
          adminLogin.style.display = localStorage.getItem('adminSession') === 'active' ? 'none' : 'block';
          adminControls.style.display = localStorage.getItem('adminSession') === 'active' ? 'block' : 'none';
          if (localStorage.getItem('adminSession') === 'active') {
            this.renderAdminPanel();
            this.renderAdsPanel();
          }
        }
        
        if (sectionKey !== 'home') {
          this.sections[sectionKey].style.animation = 'fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        }
      }
      
      renderChannels() {
        this.channelButtons.innerHTML = '';
        
        const sortedChannels = Object.entries(this.dataManager.channelsData).sort((a, b) => {
          return (b[1].views || 0) - (a[1].views || 0);
        });
        
        sortedChannels.forEach(([num, channel]) => {
          const btn = document.createElement('button');
          btn.className = 'button channel-btn';
          btn.id = `channelBtn-${num}`;
          btn.innerHTML = `
            <i class="fas fa-tv"></i> ${channel.name}
            ${channel.views ? `<span class="view-count">${channel.views}</span>` : ''}
          `;
          btn.addEventListener('click', () => {
            this.showSection('home', 'linkHome');
            this.streamManager.loadChannel(num);
          });
          this.channelButtons.appendChild(btn);
        });
        
        const grids = {
          allChannelsGrid: ['general'],
          newsChannelsGrid: ['news'],
          sportsChannelsGrid: ['sports'],
          childrenChannelsGrid: ['children']
        };
        
        Object.entries(grids).forEach(([gridId, categories]) => {
          const grid = document.getElementById(gridId);
          grid.innerHTML = '';
          
          sortedChannels.forEach(([num, channel]) => {
            if (categories.includes(channel.category)) {
              const card = document.createElement('div');
              card.className = 'channel-card';
              card.innerHTML = `
                <div class="channel-icon">
                  <i class="fas fa-tv"></i>
                </div>
                <h3>${channel.name}</h3>
                <span class="channel-category">${this.getCategoryName(channel.category)}</span>
                <button class="button" onclick="uiManager.showSection('home', 'linkHome'); streamManager.loadChannel(${num});">
                  <i class="fas fa-play"></i> Ù…Ø´Ø§Ù‡Ø¯Ø©
                </button>
              `;
              grid.appendChild(card);
            }
          });
        });
      }
      
      getCategoryName(category) {
        const categories = {
          general: 'Ø¹Ø§Ù…Ø©',
          news: 'Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©',
          sports: 'Ø±ÙŠØ§Ø¶ÙŠØ©',
          children: 'Ø£Ø·ÙØ§Ù„'
        };
        return categories[category] || category;
      }
      
      renderAdminPanel() {
        this.channelList.innerHTML = '';
        
        Object.entries(this.dataManager.channelsData).forEach(([num, channel]) => {
          const card = document.createElement('div');
          card.className = 'channel-card';
          card.innerHTML = `
            <span>${channel.name} <small>(${this.getCategoryName(channel.category)})</small></span>
            <div>
              <button class="button" onclick="adminManager.editChannel(${num})"><i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="button" onclick="adminManager.deleteChannel(${num})"><i class="fas fa-trash"></i> Ø­Ø°Ù</button>
            </div>
          `;
          this.channelList.appendChild(card);
        });
      }
      
      renderAdsPanel() {
        this.adList.innerHTML = '';
        
        this.dataManager.adsData.forEach(ad => {
          const card = document.createElement('div');
          card.className = 'channel-card';
          card.innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px;">
              <input type="checkbox" ${ad.active ? 'checked' : ''} onchange="adminManager.toggleAdActive(${ad.id}, this.checked)">
              <span>${ad.title} (${ad.type})</span>
            </div>
            <div>
              <button class="button" onclick="adminManager.editAd(${ad.id})"><i class="fas fa-edit"></i></button>
              <button class="button" onclick="adminManager.deleteAd(${ad.id})"><i class="fas fa-trash"></i></button>
            </div>
          `;
          this.adList.appendChild(card);
        });
      }
      
      manageWelcomeNotification() {
        if (this.dataManager.systemSettings.showWelcomeNotification) {
          setTimeout(() => {
            this.welcomeNotification.classList.add('show');
          }, 3000);
        }
      }
    }

    // =============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
    // =============================================
    class AdminManager {
      constructor(dataManager, uiManager, streamManager) {
        this.dataManager = dataManager;
        this.uiManager = uiManager;
        this.streamManager = streamManager;
        
        this.initEventListeners();
      }
      
      initEventListeners() {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('loginBtn').addEventListener('click', () => {
          const password = document.getElementById('adminPassword').value;
          const rememberMe = document.getElementById('rememberMe').checked;
          
          if (password === this.dataManager.systemSettings.adminPassword) {
            if (rememberMe) localStorage.setItem('adminSession', 'active');
            
            Swal.fire({
              title: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!',
              icon: 'success',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#10b981'
            });
            
            this.uiManager.showSection('admin', 'linkAdmin');
          } else {
            Swal.fire({
              title: 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
              text: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!',
              icon: 'error',
              confirmButtonText: 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰',
              confirmButtonColor: '#ef4444'
            });
          }
        });
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        document.getElementById('logoutBtn').addEventListener('click', () => {
          localStorage.removeItem('adminSession');
          
          Swal.fire({
            title: 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
            icon: 'success',
            confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
            confirmButtonColor: '#3b82f6'
          });
          
          this.uiManager.showSection('admin', 'linkAdmin');
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø©
        document.getElementById('addChannelBtn').addEventListener('click', () => {
          const name = document.getElementById('channelName').value.trim();
          const src = document.getElementById('channelSrc').value.trim();
          const type = document.getElementById('channelType').value;
          const category = document.getElementById('channelCategory').value;
          
          if (!name || !src) {
            Swal.fire({
              title: 'Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©!',
              text: 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.',
              icon: 'warning',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#f59e0b'
            });
            return;
          }
          
          if (type !== 'ahmad' && !this.isValidUrl(src) && type !== 'vk') {
            Swal.fire({
              title: 'Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­!',
              text: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­ Ù„Ù„Ø¨Ø«.',
              icon: 'error',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#ef4444'
            });
            return;
          }
          
          const newChannelNum = Math.max(...Object.keys(this.dataManager.channelsData).map(Number)) + 1;
          this.dataManager.channelsData[newChannelNum] = { 
            type, 
            src, 
            category, 
            name,
            thumb: `https://via.placeholder.com/300x170/1e3a8a/ffffff?text=${encodeURIComponent(name)}`
          };
          
          this.dataManager.saveData();
          this.uiManager.renderChannels();
          this.uiManager.renderAdminPanel();
          
          document.getElementById('channelName').value = '';
          document.getElementById('channelSrc').value = '';
          
          Swal.fire({
            title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!',
            text: `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø© ${name} Ø¨Ù†Ø¬Ø§Ø­.`,
            icon: 'success',
            confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
            confirmButtonColor: '#10b981'
          });
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†
        document.getElementById('addAdBtn').addEventListener('click', () => {
          const title = document.getElementById('adTitleInput').value.trim();
          const description = document.getElementById('adDescriptionInput').value.trim();
          const image = document.getElementById('adImageInput').value.trim();
          const video = document.getElementById('adVideoInput').value.trim();
          const link = document.getElementById('adLinkInput').value.trim();
          const type = document.getElementById('adType').value;
          
          if (!title) {
            Swal.fire({
              title: 'Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨!',
              text: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†.',
              icon: 'warning',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#f59e0b'
            });
            return;
          }
          
          const newAdId = Math.max(...this.dataManager.adsData.map(ad => ad.id), 0) + 1;
          this.dataManager.adsData.push({
            id: newAdId,
            title,
            description,
            image,
            video,
            link,
            type,
            active: true
          });
          
          this.dataManager.saveData();
          this.uiManager.renderAdsPanel();
          
          document.getElementById('adTitleInput').value = '';
          document.getElementById('adDescriptionInput').value = '';
          document.getElementById('adImageInput').value = '';
          document.getElementById('adVideoInput').value = '';
          document.getElementById('adLinkInput').value = '';
          
          Swal.fire({
            title: 'ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!',
            text: 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­.',
            icon: 'success',
            confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
            confirmButtonColor: '#10b981'
          });
        });
      }
      
      editChannel(num) {
        const channel = this.dataManager.channelsData[num];
        
        Swal.fire({
          title: `ØªØ¹Ø¯ÙŠÙ„ ${channel.name}`,
          html: `
            <input id="swal-name" class="swal2-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©" value="${channel.name}">
            <input id="swal-src" class="swal2-input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«" value="${channel.src}">
            <select id="swal-type" class="swal2-input">
              <option value="video" ${channel.type === 'video' ? 'selected' : ''}>ÙÙŠØ¯ÙŠÙˆ</option>
              <option value="iframe" ${channel.type === 'iframe' ? 'selected' : ''}>Ø¥Ø·Ø§Ø±</option>
              <option value="youtube" ${channel.type === 'youtube' ? 'selected' : ''}>ÙŠÙˆØªÙŠÙˆØ¨</option>
              <option value="m3u8" ${channel.type === 'm3u8' ? 'selected' : ''}>M3U8</option>
              <option value="ahmad" ${channel.type === 'ahmad' ? 'selected' : ''}>Ø³ÙŠØ±ÙØ± Ø§Ù„Ø£Ø­Ù…Ø¯</option>
              <option value="vk" ${channel.type === 'vk' ? 'selected' : ''}>VK</option>
            </select>
            <select id="swal-category" class="swal2-input">
              <option value="general" ${channel.category === 'general' ? 'selected' : ''}>Ø¹Ø§Ù…</option>
              <option value="news" ${channel.category === 'news' ? 'selected' : ''}>Ø¥Ø®Ø¨Ø§Ø±ÙŠ</option>
              <option value="sports" ${channel.category === 'sports' ? 'selected' : ''}>Ø±ÙŠØ§Ø¶ÙŠ</option>
              <option value="children" ${channel.category === 'children' ? 'selected' : ''}>Ø£Ø·ÙØ§Ù„</option>
            </select>
          `,
          focusConfirm: false,
          preConfirm: () => {
            return {
              name: document.getElementById('swal-name').value,
              src: document.getElementById('swal-src').value,
              type: document.getElementById('swal-type').value,
              category: document.getElementById('swal-category').value
            };
          },
          confirmButtonColor: '#3b82f6',
          background: 'var(--bg-color)',
          color: 'var(--text-color)'
        }).then((result) => {
          if (result.isConfirmed) {
            const { name, src, type, category } = result.value;
            if (name && src && (type === 'ahmad' || type === 'vk' || this.isValidUrl(src))) {
              this.dataManager.channelsData[num] = { ...channel, name, src, type, category };
              this.dataManager.saveData();
              this.uiManager.renderChannels();
              this.uiManager.renderAdminPanel();
              
              Swal.fire({
                title: 'ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„!',
                text: `ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ù†Ø§Ø© ${name} Ø¨Ù†Ø¬Ø§Ø­.`,
                icon: 'success',
                confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                confirmButtonColor: '#10b981'
              });
            } else {
              Swal.fire({
                title: 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©!',
                text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.',
                icon: 'error',
                confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                confirmButtonColor: '#ef4444'
              });
            }
          }
        });
      }
      
      deleteChannel(num) {
        const channelName = this.dataManager.channelsData[num].name;
        
        Swal.fire({
          title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
          text: `Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‚Ù†Ø§Ø© ${channelName} Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…!`,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#64748b',
          confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù!',
          cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
          background: 'var(--bg-color)',
          color: 'var(--text-color)'
        }).then((result) => {
          if (result.isConfirmed) {
            delete this.dataManager.channelsData[num];
            this.dataManager.saveData();
            this.uiManager.renderChannels();
            this.uiManager.renderAdminPanel();
            
            Swal.fire({
              title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù!',
              text: `ØªÙ… Ø­Ø°Ù Ù‚Ù†Ø§Ø© ${channelName} Ø¨Ù†Ø¬Ø§Ø­.`,
              icon: 'success',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#10b981'
            });
          }
        });
      }
      
      editAd(id) {
        const ad = this.dataManager.adsData.find(ad => ad.id === id);
        if (!ad) return;
        
        Swal.fire({
          title: `ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†: ${ad.title}`,
          html: `
            <input id="swal-ad-title" class="swal2-input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" value="${ad.title}">
            <textarea id="swal-ad-desc" class="swal2-input" placeholder="ÙˆØµÙ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" style="height: 100px;">${ad.description}</textarea>
            <input id="swal-ad-image" class="swal2-input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" value="${ad.image || ''}">
            <input id="swal-ad-link" class="swal2-input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" value="${ad.link || ''}">
            <select id="swal-ad-type" class="swal2-input">
              <option value="image" ${ad.type === 'image' ? 'selected' : ''}>Ø¥Ø¹Ù„Ø§Ù† ØµÙˆØ±ÙŠ</option>
              <option value="video" ${ad.type === 'video' ? 'selected' : ''}>Ø¥Ø¹Ù„Ø§Ù† ÙÙŠØ¯ÙŠÙˆ</option>
              <option value="text" ${ad.type === 'text' ? 'selected' : ''}>Ø¥Ø¹Ù„Ø§Ù† Ù†ØµÙŠ</option>
            </select>
            <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
              <input type="checkbox" id="swal-ad-active" ${ad.active ? 'checked' : ''}>
              Ù†Ø´Ø·
            </label>
          `,
          focusConfirm: false,
          preConfirm: () => {
            return {
              title: document.getElementById('swal-ad-title').value,
              description: document.getElementById('swal-ad-desc').value,
              image: document.getElementById('swal-ad-image').value,
              link: document.getElementById('swal-ad-link').value,
              type: document.getElementById('swal-ad-type').value,
              active: document.getElementById('swal-ad-active').checked
            };
          },
          confirmButtonText: 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª',
          cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
          showCancelButton: true,
          confirmButtonColor: '#3b82f6',
          background: 'var(--bg-color)',
          color: 'var(--text-color)'
        }).then((result) => {
          if (result.isConfirmed) {
            const { title, description, image, link, type, active } = result.value;
            
            if (!title) {
              Swal.fire({
                title: 'Ø®Ø·Ø£!',
                text: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù…Ø·Ù„ÙˆØ¨',
                icon: 'error',
                confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                confirmButtonColor: '#ef4444'
              });
              return;
            }
            
            ad.title = title;
            ad.description = description;
            ad.image = image;
            ad.link = link;
            ad.type = type;
            ad.active = active;
            
            this.dataManager.saveData();
            this.uiManager.renderAdsPanel();
            
            Swal.fire({
              title: 'ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„!',
              text: 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­.',
              icon: 'success',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#10b981'
            });
          }
        });
      }
      
      deleteAd(id) {
        Swal.fire({
          title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
          text: 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…!',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ef4444',
          cancelButtonColor: '#64748b',
          confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù!',
          cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
          background: 'var(--bg-color)',
          color: 'var(--text-color)'
        }).then((result) => {
          if (result.isConfirmed) {
            this.dataManager.adsData = this.dataManager.adsData.filter(ad => ad.id !== id);
            this.dataManager.saveData();
            this.uiManager.renderAdsPanel();
            
            Swal.fire({
              title: 'ØªÙ… Ø§Ù„Ø­Ø°Ù!',
              text: 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­.',
              icon: 'success',
              confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
              confirmButtonColor: '#10b981'
            });
          }
        });
      }
      
      toggleAdActive(id, isActive) {
        const adIndex = this.dataManager.adsData.findIndex(ad => ad.id === id);
        if (adIndex !== -1) {
          this.dataManager.adsData[adIndex].active = isActive;
          this.dataManager.saveData();
          
          const activeAds = this.dataManager.adsData.filter(ad => ad.active);
          if (activeAds.length === 0) {
            this.streamManager.adContainer.style.display = 'none';
          } else if (this.streamManager.currentAdIndex >= activeAds.length) {
            this.streamManager.currentAdIndex = 0;
            this.streamManager.showAd(this.streamManager.currentAdIndex);
          }
        }
      }
      
      isValidUrl(string) {
        try {
          new URL(string);
          return true;
        } catch (_) {
          return false;
        }
      }
    }

    // =============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡
    // =============================================
    class FaceRecognitionManager {
      constructor(dataManager, adminManager) {
        this.dataManager = dataManager;
        this.adminManager = adminManager;
        this.faceRecognitionInterval = null;
        
        this.initFaceRecognition();
      }
      
      async initFaceRecognition() {
        try {
          await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
          await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
          await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
          await faceapi.nets.faceExpressionNet.loadFromUri('/models');
          
          if (localStorage.getItem('adminFaces')) {
            this.dataManager.systemSettings.adminFaces = JSON.parse(localStorage.getItem('adminFaces'));
          }
          
          document.getElementById('faceLoginBtn').addEventListener('click', async () => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: true });
              const video = document.createElement('video');
              video.srcObject = stream;
              await video.play();
              
              const { value: formValues } = await Swal.fire({
                title: 'Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡',
                html: `
                  <div class="face-recognition-container">
                    <video id="faceVideo" class="face-recognition-video" autoplay muted playsinline></video>
                    <canvas id="faceCanvas" class="face-recognition-canvas"></canvas>
                    <div class="face-recognition-message">ÙŠØ±Ø¬Ù‰ Ø§Ù„ÙˆÙ‚ÙˆÙ Ø£Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</div>
                  </div>
                  <div style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                      <input type="checkbox" id="registerNewFace">
                      ØªØ³Ø¬ÙŠÙ„ ÙˆØ¬Ù‡ Ø¬Ø¯ÙŠØ¯ ÙƒÙ…Ø³Ø¤ÙˆÙ„
                    </label>
                  </div>
                `,
                focusConfirm: false,
                showConfirmButton: true,
                showCancelButton: true,
                confirmButtonText: 'ØªÙ… Ø§Ù„ØªØ¹Ø±Ù',
                cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                confirmButtonColor: '#10b981',
                cancelButtonColor: '#ef4444',
                background: 'var(--bg-color)',
                color: 'var(--text-color)',
                width: 350,
                didOpen: () => {
                  const faceVideo = document.getElementById('faceVideo');
                  faceVideo.srcObject = stream;
                  
                  const faceCanvas = document.getElementById('faceCanvas');
                  const displaySize = { width: 300, height: 300 };
                  faceapi.matchDimensions(faceCanvas, displaySize);
                  
                  this.faceRecognitionInterval = setInterval(async () => {
                    const detections = await faceapi.detectAllFaces(
                      faceVideo, 
                      new faceapi.TinyFaceDetectorOptions()
                    )
                    .withFaceLandmarks()
                    .withFaceDescriptors()
                    .withFaceExpressions();
                    
                    const resizedDetections = faceapi.resizeResults(detections, displaySize);
                    faceCanvas.getContext('2d').clearRect(0, 0, faceCanvas.width, faceCanvas.height);
                    
                    resizedDetections.forEach(detection => {
                      const box = detection.detection.box;
                      const drawBox = new faceapi.draw.DrawBox(box, {
                        label: 'ÙˆØ¬Ù‡ Ù…ÙƒØªØ´Ù',
                        boxColor: '#f59e0b'
                      });
                      drawBox.draw(faceCanvas);
                      
                      faceapi.draw.drawFaceLandmarks(faceCanvas, detection.landmarks);
                      
                      const expressions = detection.expressions;
                      const dominantExpression = Object.entries(expressions).sort((a, b) => b[1] - a[1])[0];
                      const expressionText = `${dominantExpression[0]} (${Math.round(dominantExpression[1] * 100)}%)`;
                      
                      const expressionBox = new faceapi.draw.DrawTextField(
                        [expressionText],
                        box.bottomLeft
                      );
                      expressionBox.draw(faceCanvas);
                    });
                  }, 500);
                },
                preConfirm: () => {
                  const registerNewFace = document.getElementById('registerNewFace').checked;
                  return { registerNewFace };
                }
              });
              
              if (formValues) {
                const { registerNewFace } = formValues;
                clearInterval(this.faceRecognitionInterval);
                stream.getTracks().forEach(track => track.stop());
                
                if (registerNewFace) {
                  const faceVideo = document.getElementById('faceVideo');
                  const detections = await faceapi.detectAllFaces(
                    faceVideo,
                    new faceapi.TinyFaceDetectorOptions()
                  ).withFaceLandmarks().withFaceDescriptors();
                  
                  if (detections.length > 0) {
                    const faceDescriptor = detections[0].descriptor;
                    const faceName = await Swal.fire({
                      title: 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„',
                      input: 'text',
                      inputPlaceholder: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„',
                      showCancelButton: true,
                      confirmButtonText: 'Ø­ÙØ¸',
                      cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
                      background: 'var(--bg-color)',
                      color: 'var(--text-color)'
                    });
                    
                    if (faceName.value) {
                      this.dataManager.systemSettings.adminFaces.push({
                        name: faceName.value,
                        descriptor: Array.from(faceDescriptor)
                      });
                      localStorage.setItem('adminFaces', JSON.stringify(this.dataManager.systemSettings.adminFaces));
                      this.dataManager.saveData();
                      
                      Swal.fire({
                        title: 'ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„!',
                        text: `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ÙˆØ¬Ù‡ ${faceName.value} Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù….`,
                        icon: 'success',
                        confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                        confirmButtonColor: '#10b981'
                      });
                    }
                  } else {
                    Swal.fire({
                      title: 'Ù„Ù… ÙŠØªÙ… Ø§ÙƒØªØ´Ø§Ù ÙˆØ¬Ù‡!',
                      text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù…Ø¹ Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ Ø¥Ø¶Ø§Ø¡Ø© Ø¬ÙŠØ¯Ø©.',
                      icon: 'error',
                      confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                      confirmButtonColor: '#ef4444'
                    });
                  }
                } else {
                  const faceVideo = document.getElementById('faceVideo');
                  const detections = await faceapi.detectAllFaces(
                    faceVideo,
                    new faceapi.TinyFaceDetectorOptions()
                  ).withFaceLandmarks().withFaceDescriptors();
                  
                  if (detections.length > 0 && this.dataManager.systemSettings.adminFaces.length > 0) {
                    const faceMatcher = new faceapi.FaceMatcher(
                      this.dataManager.systemSettings.adminFaces.map(face => (
                        new faceapi.LabeledFaceDescriptors(
                          face.name,
                          [new Float32Array(face.descriptor)]
                        )
                      )),
                      0.6
                    );
                    
                    const bestMatch = faceMatcher.findBestMatch(detections[0].descriptor);
                    
                    if (bestMatch.label !== 'unknown') {
                      localStorage.setItem('adminSession', 'active');
                      Swal.fire({
                        title: 'ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙƒ!',
                        html: `Ù…Ø±Ø­Ø¨Ù‹Ø§ <strong>${bestMatch.label}</strong>ØŒ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.`,
                        icon: 'success',
                        confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                        confirmButtonColor: '#10b981'
                      });
                      this.adminManager.uiManager.showSection('admin', 'linkAdmin');
                    } else {
                      Swal.fire({
                        title: 'ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ!',
                        text: 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙƒ ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù….',
                        icon: 'error',
                        confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                        confirmButtonColor: '#ef4444'
                      });
                    }
                  } else if (this.dataManager.systemSettings.adminFaces.length === 0) {
                    Swal.fire({
                      title: 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¬ÙˆÙ‡ Ù…Ø³Ø¬Ù„Ø©!',
                      text: 'ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ ÙˆØ¬Ù‡ Ù…Ø³Ø¤ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.',
                      icon: 'warning',
                      confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                      confirmButtonColor: '#f59e0b'
                    });
                  } else {
                    Swal.fire({
                      title: 'Ù„Ù… ÙŠØªÙ… Ø§ÙƒØªØ´Ø§Ù ÙˆØ¬Ù‡!',
                      text: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù…Ø¹ Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ Ø¥Ø¶Ø§Ø¡Ø© Ø¬ÙŠØ¯Ø©.',
                      icon: 'error',
                      confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                      confirmButtonColor: '#ef4444'
                    });
                  }
                }
              } else {
                clearInterval(this.faceRecognitionInterval);
                stream.getTracks().forEach(track => track.stop());
              }
            } catch (error) {
              console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡:', error);
              Swal.fire({
                title: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!',
                text: 'ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.',
                icon: 'error',
                confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                confirmButtonColor: '#ef4444'
              });
            }
          });
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡:', error);
          document.getElementById('faceLoginBtn').style.display = 'none';
        }
      }
    }

    // =============================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµÙˆØªÙŠ
    // =============================================
    class VoiceControlManager {
      constructor(streamManager, uiManager) {
        this.streamManager = streamManager;
        this.uiManager = uiManager;
        this.recognition = null;
        this.isVoiceControlActive = false;
        
        this.initVoiceControl();
      }
      
      initVoiceControl() {
        try {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          this.recognition = new SpeechRecognition();
          this.recognition.continuous = true;
          this.recognition.interimResults = true;
          this.recognition.lang = 'ar-SA';
          
          this.recognition.onstart = () => {
            this.isVoiceControlActive = true;
            document.getElementById('voiceControlBtn').classList.add('listening');
            Swal.fire({
              position: 'top-end',
              title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹...',
              icon: 'info',
              showConfirmButton: false,
              timer: 2000,
              timerProgressBar: true,
              toast: true
            });
          };
          
          this.recognition.onerror = (event) => {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ:', event.error);
            this.isVoiceControlActive = false;
            document.getElementById('voiceControlBtn').classList.remove('listening');
            
            if (event.error === 'not-allowed') {
              Swal.fire({
                title: 'Ø§Ù„Ø¥Ø°Ù† Ù…Ø±ÙÙˆØ¶!',
                text: 'ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„ØªØ­ÙƒÙ… Ø§Ù„ØµÙˆØªÙŠ.',
                icon: 'error',
                confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
                confirmButtonColor: '#ef4444'
              });
            }
          };
          
          this.recognition.onend = () => {
            if (this.isVoiceControlActive) {
              this.recognition.start();
            } else {
              document.getElementById('voiceControlBtn').classList.remove('listening');
            }
          };
          
          this.recognition.onresult = (event) => {
            const transcript = Array.from(event.results)
              .map(result => result[0])
              .map(result => result.transcript)
              .join('')
              .toLowerCase();
              
            if (event.results[0].isFinal) {
              this.processVoiceCommand(transcript);
            }
          };
          
          document.getElementById('voiceControlBtn').addEventListener('click', () => {
            if (!this.isVoiceControlActive) {
              this.isVoiceControlActive = true;
              this.recognition.start();
            } else {
              this.isVoiceControlActive = false;
              this.recognition.stop();
            }
          });
        } catch (error) {
          console.error('Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…:', error);
          document.getElementById('voiceControlBtn').style.display = 'none';
        }
      }
      
      processVoiceCommand(command) {
        console.log('Ø§Ù„Ø£Ù…Ø± Ø§Ù„ØµÙˆØªÙŠ:', command);
        
        if (command.includes('Ø´ØºÙ„') || command.includes('Ø§ÙØªØ­') || command.includes('Ø§Ø¨Ø¯Ø£')) {
          const channelName = this.extractChannelName(command);
          if (channelName) {
            const channelNum = this.findChannelByName(channelName);
            if (channelNum) {
              this.uiManager.showSection('home', 'linkHome');
              this.streamManager.loadChannel(channelNum);
              this.streamManager.showFeedback(`Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ ${this.dataManager.channelsData[channelNum].name}`);
            } else {
              this.streamManager.showFeedback('Ø§Ù„Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
            }
          }
        }
        
        else if (command.includes('Ø§ÙŠÙ‚Ø§Ù') || command.includes('ÙˆÙ‚Ù')) {
          if (!player.paused()) {
            player.pause();
            document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i> ØªØ´ØºÙŠÙ„';
            this.streamManager.showFeedback('ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù');
          }
        }
        
        else if (command.includes('Ø§Ø³ØªÙ…Ø±') || command.includes('ÙƒÙ…Ù„')) {
          if (player.paused()) {
            player.play();
            document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i> Ø¥ÙŠÙ‚Ø§Ù';
            this.streamManager.showFeedback('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„');
          }
        }
        
        else if (command.includes('ØµÙˆØª') || command.includes('Ø§Ù„ØµÙˆØª')) {
          if (player.muted()) {
            player.muted(false);
            document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-up"></i> ÙƒØªÙ…';
            this.streamManager.showFeedback('Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙˆØª');
          } else {
            player.muted(true);
            document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-mute"></i> ÙÙƒ Ø§Ù„ÙƒØªÙ…';
            this.streamManager.showFeedback('ÙƒØªÙ… Ø§Ù„ØµÙˆØª');
          }
        }
        
        else if (command.includes('Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø©') || command.includes('Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©')) {
          if (player.isFullscreen()) {
            player.exitFullscreen();
            this.streamManager.showFeedback('Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
          } else {
            player.requestFullscreen();
            this.streamManager.showFeedback('Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
          }
        }
        
        else if (command.includes('Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©') || command.includes('Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©')) {
          this.uiManager.showSection('home', 'linkHome');
          this.streamManager.showFeedback('Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
        }
        
        else if (command.includes('Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©') || command.includes('Ù‚Ù†ÙˆØ§Øª Ø±ÙŠØ§Ø¶ÙŠØ©')) {
          this.uiManager.showSection('sportsChannels', 'linkSportsChannels');
          this.streamManager.showFeedback('Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©');
        }
        
        else if (command.includes('Ø§Ù„Ø£Ø®Ø¨Ø§Ø±') || command.includes('Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©')) {
          this.uiManager.showSection('newsChannels', 'linkNewsChannels');
          this.streamManager.showFeedback('Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©');
        }
        
        else if (command.includes('Ø£Ø·ÙØ§Ù„') || command.includes('Ø£Ø·ÙØ§Ù„')) {
          this.uiManager.showSection('childrenChannels', 'linkChildrenChannels');
          this.streamManager.showFeedback('Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„');
        }
        
        else if (command.includes('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…') || command.includes('Ø§Ù„Ù…Ø¯ÙŠØ±')) {
          this.uiManager.showSection('admin', 'linkAdmin');
          this.streamManager.showFeedback('Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
        }
        
        else if (command.includes('Ø¥Ø¹Ù„Ø§Ù†') || command.includes('Ø¥Ø¹Ù„Ø§Ù†Ø§Øª')) {
          if (this.streamManager.adContainer.style.display === 'none') {
            this.streamManager.showAd(this.streamManager.currentAdIndex);
            this.streamManager.showFeedback('Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
          } else {
            this.streamManager.adContainer.style.display = 'none';
            this.streamManager.showFeedback('Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
          }
        }
        
        else if (command.includes('Ù…Ø³Ø§Ø¹Ø¯Ø©') || command.includes('Ø§Ù„Ø£ÙˆØ§Ù…Ø±')) {
          Swal.fire({
            title: 'Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØµÙˆØªÙŠØ© Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©',
            html: `
              <div style="text-align: right;">
                <p><strong>Ø§Ù„ØªØ´ØºÙŠÙ„:</strong> "Ø´ØºÙ„ Ù‚Ù†Ø§Ø© Ø¥Ù… Ø¨ÙŠ Ø³ÙŠ 1"</p>
                <p><strong>Ø§Ù„ØªØ­ÙƒÙ…:</strong> "Ø§ÙŠÙ‚Ø§Ù"ØŒ "Ø§Ø³ØªÙ…Ø±"ØŒ "ØµÙˆØª"ØŒ "Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø©"</p>
                <p><strong>Ø§Ù„ØªÙ†Ù‚Ù„:</strong> "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"ØŒ "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©"ØŒ "Ø§Ù„Ø£Ø®Ø¨Ø§Ø±"ØŒ "Ø£Ø·ÙØ§Ù„"ØŒ "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"</p>
                <p><strong>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</strong> "Ø¥Ø¹Ù„Ø§Ù†"ØŒ "Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¹Ù„Ø§Ù†"</p>
              </div>
            `,
            icon: 'info',
            confirmButtonText: 'Ø­Ø³Ù†Ù‹Ø§',
            confirmButtonColor: '#3b82f6',
            background: 'var(--bg-color)',
            color: 'var(--text-color)'
          });
        }
      }
      
      extractChannelName(command) {
        const prefixes = ['Ø´ØºÙ„', 'Ø§ÙØªØ­', 'Ø§Ø¨Ø¯Ø£'];
        for (const prefix of prefixes) {
          if (command.startsWith(prefix)) {
            return command.replace(prefix, '').trim();
          }
        }
        return null;
      }
      
      findChannelByName(name) {
        for (const [num, channel] of Object.entries(this.dataManager.channelsData)) {
          if (channel.name.includes(name) || name.includes(channel.name)) {
            return num;
          }
        }
        return null;
      }
    }

    // =============================================
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    // =============================================
    function createParticles() {
      const particleCount = window.innerWidth < 768 ? 30 : 50;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        const size = Math.random() * 5 + 2;
        const posX = Math.random() * window.innerWidth;
        const posY = Math.random() * window.innerHeight;
        const opacity = Math.random() * 0.5 + 0.1;
        const animationDuration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}px`;
        particle.style.top = `${posY}px`;
        particle.style.opacity = opacity;
        particle.style.animation = `float ${animationDuration}s ease-in-out ${delay}s infinite`;
        
        document.getElementById('particles').appendChild(particle);
      }
    }

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('load', async () => {
      createParticles();
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø«ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†
      const dataManager = new DataManager();
      const streamManager = new StreamManager(dataManager);
      const uiManager = new UIManager(dataManager, streamManager);
      const adminManager = new AdminManager(dataManager, uiManager, streamManager);
      const faceRecognitionManager = new FaceRecognitionManager(dataManager, adminManager);
      const voiceControlManager = new VoiceControlManager(streamManager, uiManager);
      
      // Ø¬Ø¹Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† Ù…ØªØ§Ø­ÙŠÙ† Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹ Ù„Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø¶Ù…Ù†Ø© ÙÙŠ HTML
      window.dataManager = dataManager;
      window.streamManager = streamManager;
      window.uiManager = uiManager;
      window.adminManager = adminManager;
      
      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø§Ù„ØªÙŠ ØªÙ… Ù…Ø´Ø§Ù‡Ø¯ØªÙ‡Ø§
      const lastWatched = localStorage.getItem('lastWatched') || 1;
      streamManager.loadChannel(lastWatched);
      
      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
      setInterval(() => {
        const status = document.getElementById('aiStatus');
        if (Math.random() > 0.1) {
          status.innerHTML = '<i class="fas fa-circle"></i> Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù†Ø´Ø·';
          status.style.color = '#10b981';
        } else {
          status.innerHTML = '<i class="fas fa-circle"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ù„Ù…...';
          status.style.color = '#f59e0b';
        }
      }, 5000);
    });
  </script>
</body>
</html>