<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="منصة MCRN 360 الذكية للبث المباشر والإعلانات المميزة">
  <meta name="theme-color" content="#0f172a">
  <title>MCRN 360 PRO - البث الذكي</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://vjs.zencdn.net/8.10.0/video-js.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <style>
    :root {
      --bg-color: #0f172a;
      --primary-color: #3b82f6;
      --hover-color: #f59e0b;
      --text-color: #e2e8f0;
      --button-color: #1e40af;
      --button-hover: #f97316;
      --gradient-bg: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
      --glass-bg: rgba(15, 23, 42, 0.85);
      --font-family: 'Tajawal', sans-serif;
      --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --ad-primary: #4f46e5;
      --ad-secondary: #10b981;
      --error-color: #ef4444;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.6;
      overflow-x: hidden;
      perspective: 1000px;
    }

    nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      padding: 12px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    nav .logo {
      font-size: clamp(22px, 5vw, 28px);
      font-weight: 900;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .logo .ai-badge {
      background: linear-gradient(135deg, #f59e0b, #ef4444);
      color: white;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      font-weight: 700;
    }

    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
      transition: var(--transition);
    }

    .menu-toggle:hover {
      color: var(--hover-color);
      transform: rotate(90deg);
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 16px;
      margin: 0;
      padding: 0;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    nav ul li a {
      color: var(--text-color);
      text-decoration: none;
      font-size: clamp(15px, 4vw, 18px);
      padding: 10px 16px;
      border-radius: 12px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    nav ul li a::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 3px;
      background: var(--hover-color);
      transition: var(--transition);
    }

    nav ul li a:hover, nav ul li a.active {
      color: var(--hover-color);
      background: rgba(245, 158, 11, 0.1);
    }

    nav ul li a:hover::before, nav ul li a.active::before {
      width: 100%;
    }

    .section {
      margin-top: 80px;
      padding: 24px;
      text-align: center;
      display: none;
      max-width: 1600px;
      margin-left: auto;
      margin-right: auto;
      animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }

    .section.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #homeSection {
      background: var(--gradient-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-xl);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #homeSection h1 {
      font-size: clamp(28px, 6vw, 42px);
      margin: 24px 0;
      background: linear-gradient(90deg, #f59e0b, #3b82f6);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: 900;
      letter-spacing: -1px;
    }

    .stream-container {
      position: relative;
      width: 100%;
      max-width: 1600px;
      margin: 24px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 30px rgba(0, 0, 0, 0.6);
      background: #000;
      transform-style: preserve-3d;
      transition: var(--transition);
    }

    .stream-container:hover {
      transform: translateY(-5px) scale(1.005);
      box-shadow: 0 25px 35px rgba(0, 0, 0, 0.7);
    }

    .stream-container::before {
      content: "";
      display: block;
      padding-top: 56.25%;
    }

    .stream-container .video-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      border-radius: 20px;
    }

    .stream-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 20px;
    }

    .stream-error-message {
      position: absolute;
      top: 20px;
      right: 20px;
      left: 20px;
      background: rgba(239, 68, 68, 0.9);
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 100;
      animation: slideIn 0.3s ease-out;
      transition: opacity 0.5s ease;
    }

    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .ad-container {
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: none;
      position: relative;
    }

    .ad-content {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(135deg, var(--ad-primary), var(--ad-secondary));
      color: white;
    }

    .ad-image {
      max-width: 100%;
      max-height: 300px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .ad-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .ad-description {
      font-size: 1rem;
      margin-bottom: 15px;
      text-align: center;
    }

    .ad-close {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
    }

    .ad-nav {
      display: flex;
      justify-content: center;
      margin-top: 15px;
      gap: 10px;
    }

    .ad-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      transition: var(--transition);
    }

    .ad-dot.active {
      background: white;
      transform: scale(1.2);
    }

    .smart-controls {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 24px 0;
      flex-wrap: wrap;
    }

    .button {
      padding: 12px 24px;
      background: var(--button-color);
      color: var(--text-color);
      border: none;
      border-radius: 12px;
      font-size: clamp(15px, 4vw, 18px);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }

    .button::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
      opacity: 0;
      transition: var(--transition);
    }

    .button:hover {
      background: var(--button-hover);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
    }

    .button:hover::after {
      opacity: 1;
    }

    .button:active {
      transform: translateY(1px) scale(0.98);
    }

    .voice-control-btn {
      background: linear-gradient(135deg, #10b981, #3b82f6);
      position: fixed;
      bottom: 30px;
      left: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: var(--transition);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
      70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); }
      100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
    }

    .voice-control-btn:hover {
      transform: scale(1.1);
      background: linear-gradient(135deg, #3b82f6, #10b981);
    }

    .voice-control-btn.listening {
      animation: listening 1.5s infinite;
      background: linear-gradient(135deg, #ef4444, #f59e0b);
    }

    @keyframes listening {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .channels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      padding: 16px;
    }

    .channel-card {
      background: rgba(30, 58, 138, 0.3);
      border-radius: 16px;
      padding: 20px;
      transition: var(--transition);
      cursor: pointer;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 180px;
      position: relative;
      overflow: hidden;
    }

    .channel-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        to bottom right,
        rgba(59, 130, 246, 0.1),
        rgba(245, 158, 11, 0.1)
      );
      transform: rotate(45deg);
      z-index: -1;
    }

    .channel-card:hover {
      background: rgba(245, 158, 11, 0.5);
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
    }

    .channel-card h3 {
      color: var(--primary-color);
      font-size: clamp(18px, 5vw, 22px);
      margin: 12px 0;
      font-weight: 700;
    }

    .channel-card .channel-icon {
      font-size: 40px;
      color: var(--hover-color);
      margin-bottom: 10px;
    }

    .channel-card .channel-category {
      background: rgba(15, 23, 42, 0.7);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      margin-top: 8px;
      color: var(--hover-color);
    }

    #adminSection {
      background: rgba(15, 23, 42, 0.9);
      padding: 32px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #adminSection h1 {
      color: var(--primary-color);
      font-size: clamp(26px, 5vw, 36px);
      margin-bottom: 24px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .admin-section {
      background: rgba(255, 255, 255, 0.05);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: var(--transition);
    }

    .admin-section:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-3px);
    }

    .admin-section h2 {
      color: var(--hover-color);
      font-size: clamp(20px, 4vw, 24px);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #channelList .channel-card {
      flex-direction: row;
      justify-content: space-between;
      padding: 16px;
      min-height: auto;
    }

    #adminLogin input, #adminControls input, #adminControls select, #adminControls textarea {
      width: 100%;
      max-width: 400px;
      margin: 12px auto;
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      display: block;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-family: var(--font-family);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: var(--transition);
    }

    #adminLogin input:focus, #adminControls input:focus, #adminControls select:focus, #adminControls textarea:focus {
      outline: none;
      border-color: var(--hover-color);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
      background: rgba(255, 255, 255, 0.15);
    }

    #channelSearch, #filterCategory, #adSearch, #filterAdType {
      width: 48%;
      padding: 12px 16px;
      margin: 12px 1%;
      border-radius: 12px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-family: var(--font-family);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    footer {
      margin-top: auto;
      text-align: center;
      padding: 20px;
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      font-size: clamp(13px, 3vw, 15px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    footer p {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      background: rgba(59, 130, 246, 0.5);
      border-radius: 50%;
      pointer-events: none;
    }

    /* التصميم المتجاوب الذكي */
    @media (max-width: 1200px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
      
      .ad-container {
        max-width: 900px;
      }
    }

    @media (max-width: 992px) {
      .section {
        padding: 20px;
      }
      
      .smart-controls {
        gap: 12px;
      }
      
      .ad-image {
        max-height: 250px;
      }
    }

    @media (max-width: 768px) {
      nav {
        padding: 10px 16px;
      }
      
      .section {
        padding: 16px;
        margin-top: 70px;
      }
      
      .smart-controls {
        gap: 10px;
      }
      
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
      
      #channelSearch, #filterCategory, #adSearch, #filterAdType {
        width: 100%;
        margin: 8px 0;
      }
      
      .ad-title {
        font-size: 1.3rem;
      }
      
      .ad-description {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 600px) {
      .menu-toggle {
        display: block;
      }
      
      nav ul {
        position: absolute;
        top: 70px;
        right: 16px;
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        flex-direction: column;
        width: 250px;
        max-height: 0;
        overflow: hidden;
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      nav ul.show {
        max-height: 500px;
        padding: 16px;
      }
      
      nav ul li a {
        padding: 12px;
        justify-content: center;
      }
      
      .channels-grid {
        grid-template-columns: 1fr;
      }
      
      .voice-control-btn {
        width: 50px;
        height: 50px;
        bottom: 20px;
        left: 20px;
      }
      
      .ad-image {
        max-height: 200px;
      }
      
      .ad-title {
        font-size: 1.1rem;
      }
    }

    .glow {
      text-shadow: 0 0 10px rgba(59, 130, 246, 0.7);
    }

    .rotate {
      animation: rotate 10s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .progress-container {
      width: 100%;
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1001;
      display: none;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #f59e0b);
      width: 0%;
      transition: width 0.3s ease;
    }

    .welcome-notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, var(--ad-primary), var(--ad-secondary));
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      z-index: 999;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 350px;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .welcome-notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .welcome-notification .close-welcome {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      margin-right: -5px;
      margin-left: 10px;
    }

    @media (max-width: 768px) {
      .welcome-notification {
        bottom: 80px;
        right: 15px;
        left: 15px;
        max-width: none;
      }
    }

    .face-recognition-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.5);
    }

    .face-recognition-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .face-recognition-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .face-recognition-message {
      position: absolute;
      bottom: 10px;
      left: 0;
      right: 0;
      text-align: center;
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 4px;
    }

    .face-landmark {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #3b82f6;
      border-radius: 50%;
      transform: translate(-2px, -2px);
    }

    .face-box {
      position: absolute;
      border: 2px solid #f59e0b;
      border-radius: 4px;
    }

    /* أنماط جديدة لدعم 4K */
    .quality-selector {
      position: absolute;
      bottom: 60px;
      right: 20px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 8px;
      padding: 8px;
      display: none;
    }

    .quality-btn {
      display: block;
      color: white;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      margin: 4px 0;
      text-align: right;
    }

    .quality-btn:hover, .quality-btn.active {
      background: var(--primary-color);
    }

    .vjs-quality-selector {
      position: relative;
    }

    .vjs-quality-selector .vjs-menu-button {
      margin: 0;
      padding: 0;
    }

    .vjs-quality-selector .vjs-icon-placeholder:before {
      content: "4K";
      font-family: VideoJS;
      font-weight: normal;
      font-style: normal;
    }

    /* تحسينات للعرض 4K */
    @media (min-width: 1920px) {
      .stream-container {
        max-width: 2560px;
      }
      
      .section {
        max-width: 2560px;
      }
      
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      }
      
      .channel-card {
        min-height: 250px;
      }
      
      .channel-card h3 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <nav>
    <div class="logo">
      <i class="fas fa-satellite-dish rotate"></i> MCRN 360 <span class="ai-badge">AI</span>
    </div>
    <button class="menu-toggle" id="toggleMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
    <ul id="navList">
      <li><a href="#" id="linkHome" class="active"><i class="fas fa-home"></i> الرئيسية</a></li>
      <li><a href="#" id="linkAllChannels"><i class="fas fa-tv"></i> القنوات العامة</a></li>
      <li><a href="#" id="linkNewsChannels"><i class="fas fa-newspaper"></i> الإخبارية</a></li>
      <li><a href="#" id="linkSportsChannels"><i class="fas fa-football-ball"></i> الرياضية</a></li>
      <li><a href="#" id="linkChildrenChannels"><i class="fas fa-child"></i> الأطفال</a></li>
      <li><a href="#" id="linkAdmin"><i class="fas fa-cogs"></i> لوحة التحكم</a></li>
    </ul>
  </nav>

  <div id="homeSection" class="section active">
    <h1 class="glow">مرحبًا بك في <span>MCRN 360 PRO</span></h1>
    
    <div class="ad-container" id="adContainer">
      <button class="ad-close" id="adCloseBtn"><i class="fas fa-times"></i></button>
      <div class="ad-content" id="adContent">
        <img class="ad-image" id="adImage" src="" alt="إعلان">
        <h3 class="ad-title" id="adTitle"></h3>
        <p class="ad-description" id="adDescription"></p>
        <div class="ad-nav" id="adNav"></div>
      </div>
    </div>
    
    <div class="stream-container" id="streamContainer">
      <video id="videoPlayer" class="video-js vjs-big-play-centered vjs-16-9" controls preload="auto" muted playsinline>
        <source src="" type="video/mp4" />
        <p class="vjs-no-js">
          لرؤية هذا الفيديو، يرجى تمكين JavaScript أو ترقية متصفحك إلى متصفح يدعم HTML5 video
        </p>
      </video>
      <iframe id="streamIframe" src="" scrolling="auto" allowfullscreen="true" style="display: none;"></iframe>
    </div>
    <div class="smart-controls" id="videoControls">
      <button class="button" id="rewindBtn"><i class="fas fa-backward"></i> رجوع 10 ثواني</button>
      <button class="button" id="playPauseBtn"><i class="fas fa-play"></i> تشغيل</button>
      <button class="button" id="forwardBtn"><i class="fas fa-forward"></i> تقدم 10 ثواني</button>
      <button class="button" id="fullscreenBtn"><i class="fas fa-expand"></i> ملء الشاشة</button>
      <button class="button" id="volumeBtn"><i class="fas fa-volume-up"></i> الصوت</button>
      <button class="button" id="qualityBtn"><i class="fas fa-tachometer-alt"></i> الجودة</button>
    </div>
    <h2><i class="fas fa-list"></i> اختر قناة:</h2>
    <div class="smart-controls" id="channelButtons"></div>
  </div>

  <div id="allChannelsSection" class="section">
    <h1><i class="fas fa-tv"></i> القنوات العامة</h1>
    <div class="channels-grid" id="allChannelsGrid"></div>
  </div>
  <div id="newsChannelsSection" class="section">
    <h1><i class="fas fa-newspaper"></i> القنوات الإخبارية</h1>
    <div class="channels-grid" id="newsChannelsGrid"></div>
  </div>
  <div id="sportsChannelsSection" class="section">
    <h1><i class="fas fa-football-ball"></i> القنوات الرياضية</h1>
    <div class="channels-grid" id="sportsChannelsGrid"></div>
  </div>
  <div id="childrenChannelsSection" class="section">
    <h1><i class="fas fa-child"></i> قنوات الأطفال</h1>
    <div class="channels-grid" id="childrenChannelsGrid"></div>
  </div>

  <div id="adminSection" class="section">
    <h1><i class="fas fa-user-shield"></i> لوحة التحكم الذكية</h1>
    <div id="adminLogin">
      <input type="password" id="adminPassword" placeholder="🔒 أدخل كلمة المرور">
      <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin: 12px 0;">
        <label style="cursor: pointer;"><input type="checkbox" id="rememberMe"> تذكرني</label>
        <button class="button" id="faceLoginBtn"><i class="fas fa-user-check"></i> التعرف على الوجه</button>
      </div>
      <button class="button" id="loginBtn"><i class="fas fa-sign-in-alt"></i> تسجيل الدخول</button>
    </div>
    <div id="adminControls" style="display: none;">
      <div class="admin-section">
        <h2><i class="fas fa-plus-circle"></i> إضافة قناة جديدة</h2>
        <input type="text" id="channelName" placeholder="📺 اسم القناة" required>
        <input type="url" id="channelSrc" placeholder="🔗 رابط البث" required>
        <select id="channelType">
          <option value="video">🎥 فيديو</option>
          <option value="iframe">🖼️ إطار</option>
          <option value="youtube">▶️ يوتيوب</option>
          <option value="m3u8">📡 M3U8</option>
          <option value="ahmad">📺 سيرفر الأحمد</option>
          <option value="vk">🔴 VK</option>
        </select>
        <select id="channelCategory">
          <option value="general">🌐 عام</option>
          <option value="news">📰 إخباري</option>
          <option value="sports">⚽ رياضي</option>
          <option value="children">🧸 أطفال</option>
        </select>
        <button class="button" id="addChannelBtn"><i class="fas fa-plus"></i> إضافة قناة</button>
      </div>
      <div class="admin-section">
        <h2><i class="fas fa-cog"></i> إدارة القنوات</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
          <input type="text" id="channelSearch" placeholder="🔍 ابحث عن قناة...">
          <select id="filterCategory">
            <option value="">📂 جميع الفئات</option>
            <option value="general">🌐 عام</option>
            <option value="news">📰 إخباري</option>
            <option value="sports">⚽ رياضي</option>
            <option value="children">🧸 أطفال</option>
          </select>
        </div>
        <div id="channelList" class="channels-grid"></div>
      </div>
      
      <div class="admin-section">
        <h2><i class="fas fa-ad"></i> إدارة الإعلانات</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
          <input type="text" id="adSearch" placeholder="🔍 ابحث عن إعلان...">
          <select id="filterAdType">
            <option value="">📂 جميع الأنواع</option>
            <option value="image">🖼️ صورة</option>
            <option value="video">🎥 فيديو</option>
            <option value="text">📝 نصي</option>
          </select>
        </div>
        <div id="adList" class="channels-grid"></div>
      </div>
      
      <div class="admin-section">
        <h2><i class="fas fa-plus-circle"></i> إضافة إعلان جديد</h2>
        <input type="text" id="adTitleInput" placeholder="📌 عنوان الإعلان" required>
        <textarea id="adDescriptionInput" placeholder="📝 وصف الإعلان" rows="3"></textarea>
        <input type="url" id="adImageInput" placeholder="🖼️ رابط الصورة (اختياري)">
        <input type="url" id="adVideoInput" placeholder="🎥 رابط الفيديو (اختياري)">
        <input type="url" id="adLinkInput" placeholder="🔗 رابط الإعلان (اختياري)">
        <select id="adType">
          <option value="image">🖼️ إعلان صوري</option>
          <option value="video">🎥 إعلان فيديو</option>
          <option value="text">📝 إعلان نصي</option>
        </select>
        <button class="button" id="addAdBtn"><i class="fas fa-plus"></i> إضافة إعلان</button>
      </div>
      
      <div class="admin-section">
        <h2><i class="fas fa-bell"></i> إدارة الإشعارات</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 15px;">
          <input type="text" id="notificationTitle" placeholder="📌 عنوان الإشعار" style="flex: 1;">
          <textarea id="notificationMessage" placeholder="📝 محتوى الإشعار" rows="2" style="width: 100%;"></textarea>
          <select id="notificationType" style="flex: 1;">
            <option value="info">ℹ️ معلوماتي</option>
            <option value="success">✅ نجاح</option>
            <option value="warning">⚠️ تحذير</option>
            <option value="error">❌ خطأ</option>
          </select>
        </div>
        <button class="button" id="sendNotificationBtn"><i class="fas fa-paper-plane"></i> إرسال إشعار</button>
        <button class="button" id="toggleWelcomeBtn"><i class="fas fa-comment"></i> تبديل إشعار الترحيب</button>
      </div>
      
      <button class="button" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
    </div>
  </div>

  <div class="voice-control-btn" id="voiceControlBtn" title="التحكم الصوتي">
    <i class="fas fa-microphone"></i>
  </div>

  <div class="particles" id="particles"></div>

  <div class="welcome-notification" id="welcomeNotification">
    <i class="fas fa-hand-wave"></i>
    <div>
      <strong>مرحبًا بك في MCRN 360 PRO!</strong>
      <p>استمتع بتجربة مشاهدة فريدة مع أحدث القنوات والميزات الذكية.</p>
    </div>
    <button class="close-welcome" id="closeWelcomeBtn"><i class="fas fa-times"></i></button>
  </div>

  <footer>
    <p><i class="fas fa-copyright"></i> 2026 MCRN 360 PRO. جميع الحقوق محفوظة. <span id="aiStatus" style="color: #10b981;"><i class="fas fa-circle"></i> الذكاء الاصطناعي نشط</span></p>
  </footer>

  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  
  <script>
    // تهيئة المشغل مع دعم HLS و DASH
    const player = videojs('videoPlayer', {
      fluid: true,
      responsive: true,
      controls: true,
      playbackRates: [0.25, 0.5, 1, 1.5, 2, 3],
      userActions: {
        hotkeys: true,
        doubleClick: true
      },
      html5: {
        vhs: {
          overrideNative: true,
          enableLowInitialPlaylist: true,
          smoothQualityChange: true,
          useDevicePixelRatio: true
        }
      }
    });

    // إضافة دعم HLS و DASH
    if (videojs.getTech('Html5')) {
      const html5Tech = videojs.getTech('Html5');
      html5Tech.registerSourceHandler({
        canPlaySource: function(source) {
          const type = source.type.toLowerCase();
          if (type === 'application/x-mpegurl' || type === 'application/vnd.apple.mpegurl') {
            return 'probably';
          }
          if (type === 'application/dash+xml') {
            return 'probably';
          }
          return '';
        },
        handleSource: function(source, tech) {
          if (Hls.isSupported() && (source.type === 'application/x-mpegurl' || source.type === 'application/vnd.apple.mpegurl')) {
            const hls = new Hls();
            hls.loadSource(source.src);
            hls.attachMedia(tech.el());
            return hls;
          } else if (source.type === 'application/dash+xml') {
            const dash = dashjs.MediaPlayer().create();
            dash.initialize(tech.el(), source.src, true);
            return dash;
          }
          return null;
        }
      });
    }

    // بيانات القنوات مع دعم متعدد للسيرفرات
    let channelsData = JSON.parse(localStorage.getItem('channelsData')) || {
      1: { 
        type: 'video', 
        src: 'https://vjs.zencdn.net/v/oceans.mp4', 
        category: 'general', 
        name: 'القناة التجريبية',
        thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=MCRN+Demo'
      },
      2: { 
        type: 'ahmad', 
        src: 'mbc1', 
        category: 'general', 
        name: 'MBC 1',
        thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=MBC1'
      },
      3: { 
        type: 'youtube', 
        src: 'https://www.youtube.com/embed/live_stream?channel=UCYJdpnjuSWVOLgGT9fIzL0g', 
        category: 'general', 
        name: 'قناة يوتيوب',
        thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=YouTube'
      },
      4: { 
        type: 'm3u8', 
        src: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8', 
        category: 'general', 
        name: 'قناة M3U8',
        thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=M3U8'
      },
      5: { 
        type: 'vk', 
        src: 'https://vk.com/video-73154028_456239128', 
        category: 'general', 
        name: 'قناة VK',
        thumb: 'https://via.placeholder.com/300x170/1e3a8a/ffffff?text=VK'
      }
    };

    // بيانات الإعلانات
    let adsData = JSON.parse(localStorage.getItem('adsData')) || [
      {
        id: 1,
        title: "عرض خاص!",
        description: "احصل على خصم 30% على جميع الاشتراكات هذا الأسبوع فقط",
        image: "https://via.placeholder.com/600x300/4f46e5/ffffff?text=Special+Offer",
        link: "#",
        type: "image",
        active: true
      },
      {
        id: 2,
        title: "تطبيقنا الجديد",
        description: "حمل تطبيق MCRN 360 الآن واحصل على شهر مجاني",
        image: "https://via.placeholder.com/600x300/10b981/ffffff?text=New+App",
        link: "#",
        type: "image",
        active: true
      }
    ];

    // إعدادات النظام
    let systemSettings = JSON.parse(localStorage.getItem('systemSettings')) || {
      showWelcomeNotification: true,
      adsInterval: 30,
      lastAdShownTime: 0,
      faceRecognitionEnabled: true,
      adminFaces: []
    };

    // عناصر DOM
    const sections = {
      home: document.getElementById('homeSection'),
      allChannels: document.getElementById('allChannelsSection'),
      newsChannels: document.getElementById('newsChannelsSection'),
      sportsChannels: document.getElementById('sportsChannelsSection'),
      childrenChannels: document.getElementById('childrenChannelsSection'),
      admin: document.getElementById('adminSection')
    };
    const streamContainer = document.getElementById('streamContainer');
    const videoElement = document.getElementById('videoPlayer');
    const iframeElement = document.getElementById('streamIframe');
    const videoControls = document.getElementById('videoControls');
    const channelButtons = document.getElementById('channelButtons');
    const voiceControlBtn = document.getElementById('voiceControlBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const particlesContainer = document.getElementById('particles');
    const adContainer = document.getElementById('adContainer');
    const adCloseBtn = document.getElementById('adCloseBtn');
    const adContent = document.getElementById('adContent');
    const adImage = document.getElementById('adImage');
    const adTitle = document.getElementById('adTitle');
    const adDescription = document.getElementById('adDescription');
    const adNav = document.getElementById('adNav');
    const welcomeNotification = document.getElementById('welcomeNotification');
    const closeWelcomeBtn = document.getElementById('closeWelcomeBtn');
    const qualityBtn = document.getElementById('qualityBtn');

    // إعدادات لوحة التحكم
    const adminPassword = '77177';
    let isAdminLoggedIn = localStorage.getItem('adminSession') === 'active';
    let isVoiceControlActive = false;
    let recognition = null;
    let currentAdIndex = 0;
    let adInterval;
    let faceRecognitionInterval;
    let currentHls = null;
    let currentDash = null;

    // إنشاء جسيمات الخلفية
    function createParticles() {
      const particleCount = window.innerWidth < 768 ? 30 : 50;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        const size = Math.random() * 5 + 2;
        const posX = Math.random() * window.innerWidth;
        const posY = Math.random() * window.innerHeight;
        const opacity = Math.random() * 0.5 + 0.1;
        const animationDuration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}px`;
        particle.style.top = `${posY}px`;
        particle.style.opacity = opacity;
        particle.style.animation = `float ${animationDuration}s ease-in-out ${delay}s infinite`;
        
        particlesContainer.appendChild(particle);
      }
    }

    // تحميل القناة مع دعم متعدد للسيرفرات
    function loadChannel(channelNum) {
      showProgressBar();
      const channel = channelsData[channelNum] || channelsData[1];
      
      videoElement.style.display = 'none';
      iframeElement.style.display = 'none';
      adContainer.style.display = 'none';
      
      document.querySelectorAll('.stream-error-message').forEach(el => el.remove());
      
      // تنظيف مشغلات HLS/DASH السابقة
      if (currentHls) {
        currentHls.destroy();
        currentHls = null;
      }
      if (currentDash) {
        currentDash.reset();
        currentDash = null;
      }
      
      try {
        if (channel.type === 'video') {
          videoElement.style.display = 'block';
          player.src({ src: channel.src, type: 'video/mp4' });
          player.poster(channel.thumb || '');
          
          player.ready(() => {
            player.play().catch(err => {
              console.error('خطأ في تشغيل الفيديو:', err);
              handlePlaybackError(channel);
            });
          });
          
          player.on('error', () => {
            handlePlaybackError(channel);
          });
        } 
        else if (channel.type === 'iframe') {
          iframeElement.style.display = 'block';
          iframeElement.src = channel.src;
          
          iframeElement.onerror = () => {
            handlePlaybackError(channel);
          };
          
          iframeElement.onload = () => {
            try {
              if (iframeElement.contentDocument && iframeElement.contentDocument.title) {
                hideProgressBar();
              } else {
                handlePlaybackError(channel);
              }
            } catch (e) {
              hideProgressBar();
            }
          };
        }
        else if (channel.type === 'youtube') {
          iframeElement.style.display = 'block';
          const youtubeSrc = channel.src.includes('embed') ? channel.src : `https://www.youtube.com/embed/${channel.src}`;
          iframeElement.src = youtubeSrc;
          
          iframeElement.onerror = () => {
            handlePlaybackError(channel);
          };
          
          iframeElement.onload = () => {
            hideProgressBar();
          };
        }
        else if (channel.type === 'm3u8') {
          videoElement.style.display = 'block';
          if (Hls.isSupported()) {
            currentHls = new Hls();
            currentHls.loadSource(channel.src);
            currentHls.attachMedia(videoElement);
            currentHls.on(Hls.Events.MANIFEST_PARSED, () => {
              player.play().catch(err => {
                console.error('خطأ في تشغيل HLS:', err);
                handlePlaybackError(channel);
              });
            });
            currentHls.on(Hls.Events.ERROR, (event, data) => {
              if (data.fatal) {
                handlePlaybackError(channel);
              }
            });
          } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
            videoElement.src = channel.src;
            videoElement.addEventListener('loadedmetadata', () => {
              videoElement.play().catch(err => {
                console.error('خطأ في تشغيل HLS:', err);
                handlePlaybackError(channel);
              });
            });
          } else {
            handlePlaybackError(channel);
          }
        }
        else if (channel.type === 'ahmad') {
          iframeElement.style.display = 'block';
          const ahmadSrc = `https://www.elahmad.com/tv/live/shaka.php?id=${channel.src}`;
          iframeElement.src = ahmadSrc;
          
          iframeElement.onerror = () => {
            handlePlaybackError(channel);
          };
          
          iframeElement.onload = () => {
            hideProgressBar();
          };
        }
        else if (channel.type === 'vk') {
          iframeElement.style.display = 'block';
          const vkSrc = channel.src.includes('embed') ? channel.src : `https://vk.com/video_ext.php?${channel.src.split('?')[1] || ''}`;
          iframeElement.src = vkSrc;
          
          iframeElement.onerror = () => {
            handlePlaybackError(channel);
          };
          
          iframeElement.onload = () => {
            hideProgressBar();
          };
        }
        
        localStorage.setItem('lastWatched', channelNum);
        document.querySelectorAll('.channel-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`channelBtn-${channelNum}`)?.classList.add('active');
        analyzeViewingHabits(channelNum);
        startAdCycle();
        
      } catch (error) {
        console.error('خطأ في تحميل القناة:', error);
        handlePlaybackError(channel);
      }
    }

    // معالجة أخطاء التشغيل
    function handlePlaybackError(channel) {
      hideProgressBar();
      console.error(`خطأ في تشغيل القناة: ${channel.name}`);
      
      const alternativeChannel = findAlternativeChannel(channel);
      
      if (alternativeChannel) {
        const errorMessage = document.createElement('div');
        errorMessage.className = 'stream-error-message';
        errorMessage.innerHTML = `
          <i class="fas fa-exclamation-triangle"></i>
          <span>جاري تحويلك إلى قناة بديلة بسبب مشكلة تقنية</span>
        `;
        streamContainer.prepend(errorMessage);
        
        setTimeout(() => {
          errorMessage.style.opacity = '0';
          setTimeout(() => errorMessage.remove(), 500);
        }, 5000);
        
        loadChannel(alternativeChannel);
      } else {
        player.poster('https://via.placeholder.com/800x450/1e293b/ffffff?text=خطأ+في+الاتصال');
        player.createModal(`
          <div style="text-align:center;padding:20px;">
            <i class="fas fa-exclamation-triangle" style="font-size:3em;color:#f59e0b;"></i>
            <h3 style="margin-top:15px;">تعذر الاتصال بالقناة</h3>
            <p style="margin:15px 0;">يرجى التحقق من اتصال الإنترنت أو تجربة قناة أخرى</p>
            <button onclick="window.location.reload()" style="
              background: #3b82f6;
              color: white;
              border: none;
              padding: 10px 20px;
              border-radius: 8px;
              cursor: pointer;
            ">إعادة المحاولة</button>
          </div>
        `);
      }
    }

    // البحث عن قناة بديلة
    function findAlternativeChannel(currentChannel) {
      for (const [num, channel] of Object.entries(channelsData)) {
        if (channel.category === currentChannel.category && num !== currentChannel.num && channel.src !== currentChannel.src) {
          return num;
        }
      }
      return null;
    }

    // بدء دورة عرض الإعلانات
    function startAdCycle() {
      if (adInterval) clearInterval(adInterval);
      
      const activeAds = adsData.filter(ad => ad.active);
      if (activeAds.length === 0) return;
      
      showAd(currentAdIndex);
      
      adInterval = setInterval(() => {
        currentAdIndex = (currentAdIndex + 1) % activeAds.length;
        showAd(currentAdIndex);
      }, systemSettings.adsInterval * 60 * 1000);
    }

    // عرض إعلان
    function showAd(index) {
      const activeAds = adsData.filter(ad => ad.active);
      if (index >= activeAds.length) return;
      
      const ad = activeAds[index];
      
      adTitle.textContent = ad.title;
      adDescription.textContent = ad.description;
      
      if (ad.image) {
        adImage.src = ad.image;
        adImage.style.display = 'block';
      } else {
        adImage.style.display = 'none';
      }
      
      updateAdNav(activeAds.length, index);
      adContainer.style.display = 'block';
      systemSettings.lastAdShownTime = Date.now();
      localStorage.setItem('systemSettings', JSON.stringify(systemSettings));
    }

    // تحديث نقاط تنقل الإعلانات
    function updateAdNav(totalAds, currentIndex) {
      adNav.innerHTML = '';
      
      for (let i = 0; i < totalAds; i++) {
        const dot = document.createElement('div');
        dot.classList.add('ad-dot');
        if (i === currentIndex) dot.classList.add('active');
        dot.addEventListener('click', () => {
          currentAdIndex = i;
          showAd(currentAdIndex);
        });
        adNav.appendChild(dot);
      }
    }

    // إغلاق الإعلان
    adCloseBtn.addEventListener('click', () => {
      adContainer.style.display = 'none';
    });

    // تحليل عادات المشاهدة
    function analyzeViewingHabits(channelNum) {
      const channel = channelsData[channelNum];
      if (!channel) return;
      
      console.log(`تحليل المشاهدة: ${channel.name} (${channel.category})`);
      channel.views = (channel.views || 0) + 1;
      localStorage.setItem('channelsData', JSON.stringify(channelsData));
      renderChannels();
    }

    // عرض القنوات
    function renderChannels() {
      channelButtons.innerHTML = '';
      
      const sortedChannels = Object.entries(channelsData).sort((a, b) => {
        return (b[1].views || 0) - (a[1].views || 0);
      });
      
      sortedChannels.forEach(([num, channel]) => {
        const btn = document.createElement('button');
        btn.className = 'button channel-btn';
        btn.id = `channelBtn-${num}`;
        btn.innerHTML = `
          <i class="fas fa-tv"></i> ${channel.name}
          ${channel.views ? `<span class="view-count">${channel.views}</span>` : ''}
        `;
        btn.addEventListener('click', () => {
          showSection('home', 'linkHome');
          loadChannel(num);
        });
        channelButtons.appendChild(btn);
      });

      const grids = {
        allChannelsGrid: ['general'],
        newsChannelsGrid: ['news'],
        sportsChannelsGrid: ['sports'],
        childrenChannelsGrid: ['children']
      };
      
      Object.entries(grids).forEach(([gridId, categories]) => {
        const grid = document.getElementById(gridId);
        grid.innerHTML = '';
        
        sortedChannels.forEach(([num, channel]) => {
          if (categories.includes(channel.category)) {
            const card = document.createElement('div');
            card.className = 'channel-card';
            card.innerHTML = `
              <div class="channel-icon">
                <i class="fas fa-tv"></i>
              </div>
              <h3>${channel.name}</h3>
              <span class="channel-category">${getCategoryName(channel.category)}</span>
              <button class="button" onclick="showSection('home', 'linkHome'); loadChannel(${num});">
                <i class="fas fa-play"></i> مشاهدة
              </button>
            `;
            grid.appendChild(card);
          }
        });
      });
    }

    // الحصول على اسم الفئة
    function getCategoryName(category) {
      const categories = {
        general: 'عامة',
        news: 'إخبارية',
        sports: 'رياضية',
        children: 'أطفال'
      };
      return categories[category] || category;
    }

    // التحكم في الفيديو
    document.getElementById('rewindBtn').addEventListener('click', () => {
      player.currentTime(player.currentTime() - 10);
      showFeedback('رجوع 10 ثواني');
    });
    
    document.getElementById('playPauseBtn').addEventListener('click', () => {
      if (player.paused()) {
        player.play();
        document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i> إيقاف';
        showFeedback('تشغيل');
      } else {
        player.pause();
        document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i> تشغيل';
        showFeedback('إيقاف');
      }
    });
    
    document.getElementById('forwardBtn').addEventListener('click', () => {
      player.currentTime(player.currentTime() + 10);
      showFeedback('تقدم 10 ثواني');
    });
    
    document.getElementById('fullscreenBtn').addEventListener('click', () => {
      if (player.isFullscreen()) {
        player.exitFullscreen();
        showFeedback('خروج من ملء الشاشة');
      } else {
        player.requestFullscreen();
        showFeedback('ملء الشاشة');
      }
    });
    
    document.getElementById('volumeBtn').addEventListener('click', () => {
      if (player.muted()) {
        player.muted(false);
        document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-up"></i> كتم';
        showFeedback('إعادة الصوت');
      } else {
        player.muted(true);
        document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-mute"></i> فك الكتم';
        showFeedback('كتم الصوت');
      }
    });

    // إظهار رد فعل مرئي
    function showFeedback(message) {
      const feedback = document.createElement('div');
      feedback.className = 'feedback-message';
      feedback.textContent = message;
      feedback.style.position = 'fixed';
      feedback.style.bottom = '100px';
      feedback.style.left = '50%';
      feedback.style.transform = 'translateX(-50%)';
      feedback.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
      feedback.style.color = 'white';
      feedback.style.padding = '10px 20px';
      feedback.style.borderRadius = '20px';
      feedback.style.zIndex = '10000';
      feedback.style.animation = 'fadeInOut 2s ease-in-out';
      
      document.body.appendChild(feedback);
      
      setTimeout(() => {
        feedback.remove();
      }, 2000);
    }

    // إدارة الأقسام
    function showSection(sectionKey, linkId) {
      Object.values(sections).forEach(section => section.classList.remove('active'));
      sections[sectionKey].classList.add('active');
      document.querySelectorAll('nav ul li a').forEach(a => a.classList.remove('active'));
      if (linkId) document.getElementById(linkId).classList.add('active');
      if (window.innerWidth <= 600) document.getElementById('navList').classList.remove('show');

      if (sectionKey === 'admin') {
        const adminLogin = document.getElementById('adminLogin');
        const adminControls = document.getElementById('adminControls');
        adminLogin.style.display = isAdminLoggedIn ? 'none' : 'block';
        adminControls.style.display = isAdminLoggedIn ? 'block' : 'none';
        if (isAdminLoggedIn) {
          renderAdminPanel();
          renderAdsPanel();
        }
      }
      
      if (sectionKey !== 'home') {
        sections[sectionKey].style.animation = 'fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
      }
    }

    // ربط الروابط بالأقسام
    ['linkHome', 'linkAllChannels', 'linkNewsChannels', 'linkSportsChannels', 'linkChildrenChannels', 'linkAdmin'].forEach(id => {
      document.getElementById(id).addEventListener('click', (e) => {
        e.preventDefault();
        const sectionKey = id === 'linkAdmin' ? 'admin' : id.replace('link', '').toLowerCase();
        showSection(sectionKey, id);
      });
    });

    // قائمة التنقل في الجوال
    document.getElementById('toggleMenuBtn').addEventListener('click', () => {
      document.getElementById('navList').classList.toggle('show');
    });

    // شريط التقدم
    function showProgressBar() {
      progressContainer.style.display = 'block';
      let width = 0;
      const interval = setInterval(() => {
        if (width >= 90) {
          clearInterval(interval);
        } else {
          width += 5;
          progressBar.style.width = `${width}%`;
        }
      }, 100);
    }

    function hideProgressBar() {
      progressBar.style.width = '100%';
      setTimeout(() => {
        progressContainer.style.display = 'none';
        progressBar.style.width = '0%';
      }, 300);
    }

    // إدارة إشعار الترحيب
    function manageWelcomeNotification() {
      if (systemSettings.showWelcomeNotification) {
        setTimeout(() => {
          welcomeNotification.classList.add('show');
        }, 3000);
      }
    }

    closeWelcomeBtn.addEventListener('click', () => {
      welcomeNotification.classList.remove('show');
    });

    // تهيئة الصفحة
    window.addEventListener('load', async () => {
      createParticles();
      renderChannels();
      
      const lastWatched = localStorage.getItem('lastWatched') || 1;
      loadChannel(lastWatched);
      
      showSection('home', 'linkHome');
      
      await initFaceRecognition();
      
      if (localStorage.getItem('adminSession') === 'active') {
        isAdminLoggedIn = true;
        if (window.location.hash === '#admin') {
          showSection('admin', 'linkAdmin');
        }
      }
      
      manageWelcomeNotification();
    });

    // تسجيل الدخول
    document.getElementById('loginBtn').addEventListener('click', () => {
      const password = document.getElementById('adminPassword').value;
      const rememberMe = document.getElementById('rememberMe').checked;
      
      if (password === adminPassword) {
        isAdminLoggedIn = true;
        if (rememberMe) localStorage.setItem('adminSession', 'active');
        
        Swal.fire({
          title: 'تم تسجيل الدخول بنجاح!',
          icon: 'success',
          confirmButtonText: 'حسنًا',
          confirmButtonColor: '#10b981'
        });
        
        showSection('admin', 'linkAdmin');
      } else {
        Swal.fire({
          title: 'خطأ في تسجيل الدخول',
          text: 'كلمة المرور غير صحيحة!',
          icon: 'error',
          confirmButtonText: 'حاول مرة أخرى',
          confirmButtonColor: '#ef4444'
        });
      }
    });

    // تسجيل الخروج
    document.getElementById('logoutBtn').addEventListener('click', () => {
      isAdminLoggedIn = false;
      localStorage.removeItem('adminSession');
      
      Swal.fire({
        title: 'تم تسجيل الخروج',
        icon: 'success',
        confirmButtonText: 'حسنًا',
        confirmButtonColor: '#3b82f6'
      });
      
      showSection('admin', 'linkAdmin');
    });

    // عرض لوحة التحكم
    function renderAdminPanel() {
      const channelList = document.getElementById('channelList');
      channelList.innerHTML = '';
      
      Object.entries(channelsData).forEach(([num, channel]) => {
        const card = document.createElement('div');
        card.className = 'channel-card';
        card.innerHTML = `
          <span>${channel.name} <small>(${getCategoryName(channel.category)})</small></span>
          <div>
            <button class="button" onclick="editChannel(${num})"><i class="fas fa-edit"></i> تعديل</button>
            <button class="button" onclick="deleteChannel(${num})"><i class="fas fa-trash"></i> حذف</button>
          </div>
        `;
        channelList.appendChild(card);
      });
    }

    // إضافة قناة
    document.getElementById('addChannelBtn').addEventListener('click', () => {
      const name = document.getElementById('channelName').value.trim();
      const src = document.getElementById('channelSrc').value.trim();
      const type = document.getElementById('channelType').value;
      const category = document.getElementById('channelCategory').value;

      if (!name || !src) {
        Swal.fire({
          title: 'حقول مطلوبة!',
          text: 'يرجى ملء جميع الحقول المطلوبة.',
          icon: 'warning',
          confirmButtonText: 'حسنًا',
          confirmButtonColor: '#f59e0b'
        });
        return;
      }
      
      if (type !== 'ahmad' && !isValidUrl(src)) {
        Swal.fire({
          title: 'رابط غير صالح!',
          text: 'يرجى إدخال رابط صحيح للبث.',
          icon: 'error',
          confirmButtonText: 'حسنًا',
          confirmButtonColor: '#ef4444'
        });
        return;
      }

      const newChannelNum = Math.max(...Object.keys(channelsData).map(Number)) + 1;
      channelsData[newChannelNum] = { 
        type, 
        src, 
        category, 
        name,
        thumb: `https://via.placeholder.com/300x170/1e3a8a/ffffff?text=${encodeURIComponent(name)}`
      };
      
      localStorage.setItem('channelsData', JSON.stringify(channelsData));
      renderChannels();
      renderAdminPanel();
      
      document.getElementById('channelName').value = '';
      document.getElementById('channelSrc').value = '';
      
      Swal.fire({
        title: 'تمت الإضافة!',
        text: `تمت إضافة قناة ${name} بنجاح.`,
        icon: 'success',
        confirmButtonText: 'حسنًا',
        confirmButtonColor: '#10b981'
      });
    });

    // عرض الإعلانات في لوحة التحكم
    function renderAdsPanel() {
      const adList = document.getElementById('adList');
      adList.innerHTML = '';
      
      adsData.forEach(ad => {
        const card = document.createElement('div');
        card.className = 'channel-card';
        card.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" ${ad.active ? 'checked' : ''} onchange="toggleAdActive(${ad.id}, this.checked)">
            <span>${ad.title} (${ad.type})</span>
          </div>
          <div>
            <button class="button" onclick="editAd(${ad.id})"><i class="fas fa-edit"></i></button>
            <button class="button" onclick="deleteAd(${ad.id})"><i class="fas fa-trash"></i></button>
          </div>
        `;
        adList.appendChild(card);
      });
    }

    // تبديل حالة الإعلان
    window.toggleAdActive = function(id, isActive) {
      const adIndex = adsData.findIndex(ad => ad.id === id);
      if (adIndex !== -1) {
        adsData[adIndex].active = isActive;
        localStorage.setItem('adsData', JSON.stringify(adsData));
        
        const activeAds = adsData.filter(ad => ad.active);
        if (activeAds.length === 0) {
          adContainer.style.display = 'none';
        } else if (currentAdIndex >= activeAds.length) {
          currentAdIndex = 0;
          showAd(currentAdIndex);
        }
      }
    };

    // تحرير إعلان
    window.editAd = function(id) {
      const ad = adsData.find(ad => ad.id === id);
      if (!ad) return;
      
      Swal.fire({
        title: `تعديل الإعلان: ${ad.title}`,
        html: `
          <input id="swal-ad-title" class="swal2-input" placeholder="عنوان الإعلان" value="${ad.title}">
          <textarea id="swal-ad-desc" class="swal2-input" placeholder="وصف الإعلان" style="height: 100px;">${ad.description}</textarea>
          <input id="swal-ad-image" class="swal2-input" placeholder="رابط الصورة" value="${ad.image || ''}">
          <input id="swal-ad-link" class="swal2-input" placeholder="رابط الإعلان" value="${ad.link || ''}">
          <select id="swal-ad-type" class="swal2-input">
            <option value="image" ${ad.type === 'image' ? 'selected' : ''}>إعلان صوري</option>
            <option value="video" ${ad.type === 'video' ? 'selected' : ''}>إعلان فيديو</option>
            <option value="text" ${ad.type === 'text' ? 'selected' : ''}>إعلان نصي</option>
          </select>
          <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
            <input type="checkbox" id="swal-ad-active" ${ad.active ? 'checked' : ''}>
            نشط
          </label>
        `,
        focusConfirm: false,
        preConfirm: () => {
          return {
            title: document.getElementById('swal-ad-title').value,
            description: document.getElementById('swal-ad-desc').value,
            image: document.getElementById('swal-ad-image').value,
            link: document.getElementById('swal-ad-link').value,
            type: document.getElementById('swal-ad-type').value,
            active: document.getElementById('swal-ad-active').checked
          };
        },
        confirmButtonText: 'حفظ التعديلات',
        cancelButtonText: 'إلغاء',
        showCancelButton: true,
        confirmButtonColor: '#3b82f6',
        background: 'var(--bg-color)',
        color: 'var(--text-color)'
      }).then((result) => {
        if (result.isConfirmed) {
          const { title, description, image, link, type, active } = result.value;
          
          if (!title) {
            Swal.fire({
              title: 'خطأ!',
              text: 'عنوان الإعلان مطلوب',
              icon: 'error',
              confirmButtonText: 'حسنًا',
              confirmButtonColor: '#ef4444'
            });
            return;
          }
          
          ad.title = title;
          ad.description = description;
          ad.image = image;
          ad.link = link;
          ad.type = type;
          ad.active = active;
          
          localStorage.setItem('adsData', JSON.stringify(adsData));
          renderAdsPanel();
          
          Swal.fire({
            title: 'تم التعديل!',
            text: 'تم تحديث الإعلان بنجاح.',
            icon: 'success',
            confirmButtonText: 'حسنًا',
            confirmButtonColor: '#10b981'
          });
        }
      });
    };

    // حذف إعلان
    window.deleteAd = function(id) {
      Swal.fire({
        title: 'هل أنت متأكد؟',
        text: 'سيتم حذف هذا الإعلان بشكل دائم!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#64748b',
        confirmButtonText: 'نعم، احذف!',
        cancelButtonText: 'إلغاء',
        background: 'var(--bg-color)',
        color: 'var(--text-color)'
      }).then((result) => {
        if (result.isConfirmed) {
          adsData = adsData.filter(ad => ad.id !== id);
          localStorage.setItem('adsData', JSON.stringify(adsData));
          renderAdsPanel();
          
          Swal.fire({
            title: 'تم الحذف!',
            text: 'تم حذف الإعلان بنجاح.',
            icon: 'success',
            confirmButtonText: 'حسنًا',
            confirmButtonColor: '#10b981'
          });
        }
      });
    };

    // تعديل قناة
    window.editChannel = function(num) {
      const channel = channelsData[num];
      
      Swal.fire({
        title: `تعديل ${channel.name}`,
        html: `
          <input id="swal-name" class="swal2-input" placeholder="اسم القناة" value="${channel.name}">
          <input id="swal-src" class="swal2-input" placeholder="رابط البث" value="${channel.src}">
          <select id="swal-type" class="swal2-input">
            <option value="video" ${channel.type === 'video' ? 'selected' : ''}>فيديو</option>
            <option value="iframe" ${channel.type === 'iframe' ? 'selected' : ''}>إطار</option>
            <option value="youtube" ${channel.type === 'youtube' ? 'selected' : ''}>يوتيوب</option>
            <option value="m3u8" ${channel.type === 'm3u8' ? 'selected' : ''}>M3U8</option>
            <option value="ahmad" ${channel.type === 'ahmad' ? 'selected' : ''}>سيرفر الأحمد</option>
            <option value="vk" ${channel.type === 'vk' ? 'selected' : ''}>VK</option>
          </select>
          <select id="swal-category" class="swal2-input">
            <option value="general" ${channel.category === 'general' ? 'selected' : ''}>عام</option>
            <option value="news" ${channel.category === 'news' ? 'selected' : ''}>إخباري</option>
            <option value="sports" ${channel.category === 'sports' ? 'selected' : ''}>رياضي</option>
            <option value="children" ${channel.category === 'children' ? 'selected' : ''}>أطفال</option>
          </select>
        `,
        focusConfirm: false,
        preConfirm: () => {
          return {
            name: document.getElementById('swal-name').value,
            src: document.getElementById('swal-src').value,
            type: document.getElementById('swal-type').value,
            category: document.getElementById('swal-category').value
          };
        },
        confirmButtonColor: '#3b82f6',
        background: 'var(--bg-color)',
        color: 'var(--text-color)'
      }).then((result) => {
        if (result.isConfirmed) {
          const { name, src, type, category } = result.value;
          if (name && src && (type === 'ahmad' || isValidUrl(src))) {
            channelsData[num] = { ...channel, name, src, type, category };
            localStorage.setItem('channelsData', JSON.stringify(channelsData));
            renderChannels();
            renderAdminPanel();
            
            Swal.fire({
              title: 'تم التعديل!',
              text: `تم تحديث قناة ${name} بنجاح.`,
              icon: 'success',
              confirmButtonText: 'حسنًا',
              confirmButtonColor: '#10b981'
            });
          } else {
            Swal.fire({
              title: 'بيانات غير صالحة!',
              text: 'يرجى التأكد من صحة البيانات المدخلة.',
              icon: 'error',
              confirmButtonText: 'حسنًا',
              confirmButtonColor: '#ef4444'
            });
          }
        }
      });
    };

    // حذف قناة
    window.deleteChannel = function(num) {
      const channelName = channelsData[num].name;
      
      Swal.fire({
        title: 'هل أنت متأكد؟',
        text: `سيتم حذف قناة ${channelName} بشكل دائم!`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#64748b',
        confirmButtonText: 'نعم، احذف!',
        cancelButtonText: 'إلغاء',
        background: 'var(--bg-color)',
        color: 'var(--text-color)'
      }).then((result) => {
        if (result.isConfirmed) {
          delete channelsData[num];
          localStorage.setItem('channelsData', JSON.stringify(channelsData));
          renderChannels();
          renderAdminPanel();
          
          Swal.fire({
            title: 'تم الحذف!',
            text: `تم حذف قناة ${channelName} بنجاح.`,
            icon: 'success',
            confirmButtonText: 'حسنًا',
            confirmButtonColor: '#10b981'
          });
        }
      });
    };

    // التحقق من صحة الرابط
    function isValidUrl(string) {
      try {
        new URL(string);
        return true;
      } catch (_) {
        return false;
      }
    }

    // تهيئة التعرف على الوجه
    async function initFaceRecognition() {
      try {
        await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
        await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
        await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
        await faceapi.nets.faceExpressionNet.loadFromUri('/models');
        
        if (localStorage.getItem('adminFaces')) {
          systemSettings.adminFaces = JSON.parse(localStorage.getItem('adminFaces'));
        }
        
        document.getElementById('faceLoginBtn').addEventListener('click', async () => {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.createElement('video');
            video.srcObject = stream;
            await video.play();
            
            const { value: formValues } = await Swal.fire({
              title: 'التعرف على الوجه',
              html: `
                <div class="face-recognition-container">
                  <video id="faceVideo" class="face-recognition-video" autoplay muted playsinline></video>
                  <canvas id="faceCanvas" class="face-recognition-canvas"></canvas>
                  <div class="face-recognition-message">يرجى الوقوف أمام الكاميرا...</div>
                </div>
                <div style="margin-top: 15px;">
                  <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="registerNewFace">
                    تسجيل وجه جديد كمسؤول
                  </label>
                </div>
              `,
              focusConfirm: false,
              showConfirmButton: true,
              showCancelButton: true,
              confirmButtonText: 'تم التعرف',
              cancelButtonText: 'إلغاء',
              confirmButtonColor: '#10b981',
              cancelButtonColor: '#ef4444',
              background: 'var(--bg-color)',
              color: 'var(--text-color)',
              width: 350,
              didOpen: () => {
                const faceVideo = document.getElementById('faceVideo');
                faceVideo.srcObject = stream;
                
                const faceCanvas = document.getElementById('faceCanvas');
                const displaySize = { width: 300, height: 300 };
                faceapi.matchDimensions(faceCanvas, displaySize);
                
                faceRecognitionInterval = setInterval(async () => {
                  const detections = await faceapi.detectAllFaces(
                    faceVideo, 
                    new faceapi.TinyFaceDetectorOptions()
                  )
                  .withFaceLandmarks()
                  .withFaceDescriptors()
                  .withFaceExpressions();
                  
                  const resizedDetections = faceapi.resizeResults(detections, displaySize);
                  faceCanvas.getContext('2d').clearRect(0, 0, faceCanvas.width, faceCanvas.height);
                  
                  resizedDetections.forEach(detection => {
                    const box = detection.detection.box;
                    const drawBox = new faceapi.draw.DrawBox(box, {
                      label: 'وجه مكتشف',
                      boxColor: '#f59e0b'
                    });
                    drawBox.draw(faceCanvas);
                    
                    faceapi.draw.drawFaceLandmarks(faceCanvas, detection.landmarks);
                    
                    const expressions = detection.expressions;
                    const dominantExpression = Object.entries(expressions).sort((a, b) => b[1] - a[1])[0];
                    const expressionText = `${dominantExpression[0]} (${Math.round(dominantExpression[1] * 100)}%)`;
                    
                    const expressionBox = new faceapi.draw.DrawTextField(
                      [expressionText],
                      box.bottomLeft
                    );
                    expressionBox.draw(faceCanvas);
                  });
                }, 500);
              },
              preConfirm: () => {
                const registerNewFace = document.getElementById('registerNewFace').checked;
                return { registerNewFace };
              }
            });
            
            if (formValues) {
              const { registerNewFace } = formValues;
              clearInterval(faceRecognitionInterval);
              stream.getTracks().forEach(track => track.stop());
              
              if (registerNewFace) {
                const faceVideo = document.getElementById('faceVideo');
                const detections = await faceapi.detectAllFaces(
                  faceVideo,
                  new faceapi.TinyFaceDetectorOptions()
                ).withFaceLandmarks().withFaceDescriptors();
                
                if (detections.length > 0) {
                  const faceDescriptor = detections[0].descriptor;
                  const faceName = await Swal.fire({
                    title: 'أدخل اسم المسؤول',
                    input: 'text',
                    inputPlaceholder: 'اسم المسؤول',
                    showCancelButton: true,
                    confirmButtonText: 'حفظ',
                    cancelButtonText: 'إلغاء',
                    background: 'var(--bg-color)',
                    color: 'var(--text-color)'
                  });
                  
                  if (faceName.value) {
                    systemSettings.adminFaces.push({
                      name: faceName.value,
                      descriptor: Array.from(faceDescriptor)
                    });
                    localStorage.setItem('adminFaces', JSON.stringify(systemSettings.adminFaces));
                    
                    Swal.fire({
                      title: 'تم التسجيل!',
                      text: `تم تسجيل وجه ${faceName.value} بنجاح كمسؤول للنظام.`,
                      icon: 'success',
                      confirmButtonText: 'حسنًا',
                      confirmButtonColor: '#10b981'
                    });
                  }
                } else {
                  Swal.fire({
                    title: 'لم يتم اكتشاف وجه!',
                    text: 'يرجى المحاولة مرة أخرى مع ضمان وجود إضاءة جيدة.',
                    icon: 'error',
                    confirmButtonText: 'حسنًا',
                    confirmButtonColor: '#ef4444'
                  });
                }
              } else {
                const faceVideo = document.getElementById('faceVideo');
                const detections = await faceapi.detectAllFaces(
                  faceVideo,
                  new faceapi.TinyFaceDetectorOptions()
                ).withFaceLandmarks().withFaceDescriptors();
                
                if (detections.length > 0 && systemSettings.adminFaces.length > 0) {
                  const faceMatcher = new faceapi.FaceMatcher(
                    systemSettings.adminFaces.map(face => (
                      new faceapi.LabeledFaceDescriptors(
                        face.name,
                        [new Float32Array(face.descriptor)]
                      )
                    )),
                    0.6
                  );
                  
                  const bestMatch = faceMatcher.findBestMatch(detections[0].descriptor);
                  
                  if (bestMatch.label !== 'unknown') {
                    isAdminLoggedIn = true;
                    localStorage.setItem('adminSession', 'active');
                    Swal.fire({
                      title: 'تم التعرف عليك!',
                      html: `مرحبًا <strong>${bestMatch.label}</strong>، تم تسجيل الدخول بنجاح.`,
                      icon: 'success',
                      confirmButtonText: 'حسنًا',
                      confirmButtonColor: '#10b981'
                    });
                    showSection('admin', 'linkAdmin');
                  } else {
                    Swal.fire({
                      title: 'غير مصرح لك!',
                      text: 'لم يتم التعرف عليك كمسؤول للنظام.',
                      icon: 'error',
                      confirmButtonText: 'حسنًا',
                      confirmButtonColor: '#ef4444'
                    });
                  }
                } else if (systemSettings.adminFaces.length === 0) {
                  Swal.fire({
                    title: 'لا توجد وجوه مسجلة!',
                    text: 'يرجى تسجيل وجه مسؤول أولاً.',
                    icon: 'warning',
                    confirmButtonText: 'حسنًا',
                    confirmButtonColor: '#f59e0b'
                  });
                } else {
                  Swal.fire({
                    title: 'لم يتم اكتشاف وجه!',
                    text: 'يرجى المحاولة مرة أخرى مع ضمان وجود إضاءة جيدة.',
                    icon: 'error',
                    confirmButtonText: 'حسنًا',
                    confirmButtonColor: '#ef4444'
                  });
                }
              }
            } else {
              clearInterval(faceRecognitionInterval);
              stream.getTracks().forEach(track => track.stop());
            }
          } catch (error) {
            console.error('خطأ في التعرف على الوجه:', error);
            Swal.fire({
              title: 'خطأ في الكاميرا!',
              text: 'تعذر الوصول إلى الكاميرا. يرجى التحقق من الأذونات.',
              icon: 'error',
              confirmButtonText: 'حسنًا',
              confirmButtonColor: '#ef4444'
            });
          }
        });
      } catch (error) {
        console.error('خطأ في تحميل نماذج التعرف على الوجه:', error);
        document.getElementById('faceLoginBtn').style.display = 'none';
      }
    }

    // التحكم الصوتي
    function initVoiceControl() {
      try {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = true;
        recognition.interimResults = true;
        recognition.lang = 'ar-SA';

        recognition.onstart = () => {
          isVoiceControlActive = true;
          voiceControlBtn.classList.add('listening');
          Swal.fire({
            position: 'top-end',
            title: 'جاري الاستماع...',
            icon: 'info',
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true,
            toast: true
          });
        };

        recognition.onerror = (event) => {
          console.error('خطأ في التعرف الصوتي:', event.error);
          isVoiceControlActive = false;
          voiceControlBtn.classList.remove('listening');
          
          if (event.error === 'not-allowed') {
            Swal.fire({
              title: 'الإذن مرفوض!',
              text: 'يجب السماح باستخدام الميكروفون للتحكم الصوتي.',
              icon: 'error',
              confirmButtonText: 'حسنًا',
              confirmButtonColor: '#ef4444'
            });
          }
        };

        recognition.onend = () => {
          if (isVoiceControlActive) {
            recognition.start();
          } else {
            voiceControlBtn.classList.remove('listening');
          }
        };

        recognition.onresult = (event) => {
          const transcript = Array.from(event.results)
            .map(result => result[0])
            .map(result => result.transcript)
            .join('')
            .toLowerCase();
            
          if (event.results[0].isFinal) {
            processVoiceCommand(transcript);
          }
        };

        voiceControlBtn.addEventListener('click', () => {
          if (!isVoiceControlActive) {
            isVoiceControlActive = true;
            recognition.start();
          } else {
            isVoiceControlActive = false;
            recognition.stop();
          }
        });
      } catch (error) {
        console.error('التعرف الصوتي غير مدعوم:', error);
        voiceControlBtn.style.display = 'none';
      }
    }

    // معالجة الأوامر الصوتية
    function processVoiceCommand(command) {
      console.log('الأمر الصوتي:', command);
      
      if (command.includes('شغل') || command.includes('افتح') || command.includes('ابدأ')) {
        const channelName = extractChannelName(command);
        if (channelName) {
          const channelNum = findChannelByName(channelName);
          if (channelNum) {
            showSection('home', 'linkHome');
            loadChannel(channelNum);
            showFeedback(`جاري تشغيل ${channelsData[channelNum].name}`);
          } else {
            showFeedback('القناة غير موجودة');
          }
        }
      }
      
      else if (command.includes('ايقاف') || command.includes('وقف')) {
        if (!player.paused()) {
          player.pause();
          document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i> تشغيل';
          showFeedback('تم الإيقاف');
        }
      }
      
      else if (command.includes('استمر') || command.includes('كمل')) {
        if (player.paused()) {
          player.play();
          document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i> إيقاف';
          showFeedback('جاري التشغيل');
        }
      }
      
      else if (command.includes('صوت') || command.includes('الصوت')) {
        if (player.muted()) {
          player.muted(false);
          document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-up"></i> كتم';
          showFeedback('تم تشغيل الصوت');
        } else {
          player.muted(true);
          document.getElementById('volumeBtn').innerHTML = '<i class="fas fa-volume-mute"></i> فك الكتم';
          showFeedback('تم كتم الصوت');
        }
      }
      
      else if (command.includes('شاشة كاملة') || command.includes('ملء الشاشة')) {
        if (player.isFullscreen()) {
          player.exitFullscreen();
          showFeedback('خروج من ملء الشاشة');
        } else {
          player.requestFullscreen();
          showFeedback('ملء الشاشة');
        }
      }
      
      else if (command.includes('الرئيسية') || command.includes('الصفحة الرئيسية')) {
        showSection('home', 'linkHome');
        showFeedback('الصفحة الرئيسية');
      }
      
      else if (command.includes('الرياضية') || command.includes('قنوات رياضية')) {
        showSection('sportsChannels', 'linkSportsChannels');
        showFeedback('القنوات الرياضية');
      }
      
      else if (command.includes('الأخبار') || command.includes('إخبارية')) {
        showSection('newsChannels', 'linkNewsChannels');
        showFeedback('القنوات الإخبارية');
      }
      
      else if (command.includes('أطفال') || command.includes('أطفال')) {
        showSection('childrenChannels', 'linkChildrenChannels');
        showFeedback('قنوات الأطفال');
      }
      
      else if (command.includes('لوحة التحكم') || command.includes('المدير')) {
        showSection('admin', 'linkAdmin');
        showFeedback('لوحة التحكم');
      }
      
      else if (command.includes('إعلان') || command.includes('إعلانات')) {
        if (adContainer.style.display === 'none') {
          showAd(currentAdIndex);
          showFeedback('عرض الإعلان');
        } else {
          adContainer.style.display = 'none';
          showFeedback('إخفاء الإعلان');
        }
      }
      
      else if (command.includes('مساعدة') || command.includes('الأوامر')) {
        Swal.fire({
          title: 'الأوامر الصوتية المدعومة',
          html: `
            <div style="text-align: right;">
              <p><strong>التشغيل:</strong> "شغل قناة إم بي سي 1"</p>
              <p><strong>التحكم:</strong> "ايقاف"، "استمر"، "صوت"، "شاشة كاملة"</p>
              <p><strong>التنقل:</strong> "الرئيسية"، "الرياضية"، "الأخبار"، "أطفال"، "لوحة التحكم"</p>
              <p><strong>الإعلانات:</strong> "إعلان"، "إخفاء إعلان"</p>
            </div>
          `,
          icon: 'info',
          confirmButtonText: 'حسنًا',
          confirmButtonColor: '#3b82f6',
          background: 'var(--bg-color)',
          color: 'var(--text-color)'
        });
      }
    }

    // استخراج اسم القناة من الأمر الصوتي
    function extractChannelName(command) {
      const prefixes = ['شغل', 'افتح', 'ابدأ'];
      for (const prefix of prefixes) {
        if (command.startsWith(prefix)) {
          return command.replace(prefix, '').trim();
        }
      }
      return null;
    }

    // البحث عن القناة بالاسم
    function findChannelByName(name) {
      for (const [num, channel] of Object.entries(channelsData)) {
        if (channel.name.includes(name) || name.includes(channel.name)) {
          return num;
        }
      }
      return null;
    }

    // تهيئة التحكم الصوتي
    initVoiceControl();

    // تحديث حالة الذكاء الاصطناعي
    setInterval(() => {
      const status = document.getElementById('aiStatus');
      if (Math.random() > 0.1) {
        status.innerHTML = '<i class="fas fa-circle"></i> الذكاء الاصطناعي نشط';
        status.style.color = '#10b981';
      } else {
        status.innerHTML = '<i class="fas fa-circle"></i> جاري التعلم...';
        status.style.color = '#f59e0b';
      }
    }, 5000);
  </script>
</body>
</html>