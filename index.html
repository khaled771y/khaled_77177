<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="منصة MCRN 360 للبث المباشر والقنوات المتنوعة">
  <meta name="theme-color" content="#0d1117">
  <title>منصة MCRN 360 - بث مباشر وقنوات متنوعة</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <link href="https://vjs.zencdn.net/8.5.2/video-js.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/three@0.140.2/build/three.min.js" async></script>
  <script src="https://cdn.jsdelivr.net/npm/panolens@0.12.0/build/panolens.min.js" async></script>
  <link rel="manifest" href="/manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => console.log('Service Worker registered'))
        .catch(err => console.log('Service Worker registration failed: ', err));
    }
  </script>
  <style>
    :root {
      --bg-color: #0d1117;
      --primary-color: #1f6feb;
      --hover-color: #ff9900;
      --text-color: #c9d1d9;
      --font-family: 'Cairo', sans-serif;
      --button-hover-color: #ff6f00;
      --button-color: #1e40af;
      --gradient-bg: linear-gradient(135deg, #0d1117 20%, #1f6feb 80%);
    }
    body {
      margin: 0;
      font-family: var(--font-family);
      background: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: background 0.5s;
    }
    nav {
      width: 100%;
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      background: rgba(13, 17, 23, 0.95);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      transition: all 0.5s ease;
    }
    nav .logo {
      font-size: 26px;
      font-weight: 700;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .menu-toggle {
      display: none;
      font-size: 24px;
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 25px;
      padding: 0;
      margin: 0;
      align-items: center;
      transition: max-height 0.5s ease;
    }
    nav ul li {
      display: inline-block;
    }
    nav ul li a {
      color: var(--text-color);
      text-decoration: none;
      font-size: 18px;
      font-weight: 600;
      padding: 10px 18px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    nav ul li a:hover,
    nav ul li a.active {
      background: var(--hover-color);
      color: var(--bg-color);
      transform: scale(1.1);
    }
    .section {
      margin-top: 80px;
      text-align: center;
      padding: 20px;
      display: none;
      animation: fadeIn 0.6s ease-out;
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    .section.active {
      display: block;
    }
    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    #homeSection {
      background: var(--gradient-bg);
      border-radius: 10px;
      padding-bottom: 50px;
      color: #fff;
    }
    #homeSection h1 {
      margin-bottom: 20px;
      margin-top: 0;
      padding-top: 20px;
      font-size: 32px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    .video-container {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
      background: #000;
      display: none;
    }
    .video-container::before {
      content: "";
      display: block;
      padding-top: 56.25%;
    }
    .video-container > .video-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      object-fit: cover;
    }
    .video-container:hover {
      transform: scale(1.01);
      transition: transform 0.3s ease;
    }
    .iframe-container {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 20px auto;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
      background: #000;
      display: none;
    }
    .iframe-container iframe {
      width: 100%;
      height: 600px;
      border: none;
      object-fit: cover;
      display: block;
    }
    .panorama-container {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 20px auto;
      height: 600px;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
      background: #000;
    }
    .custom-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .button {
      padding: 12px 30px;
      background: var(--button-color);
      color: var(--text-color);
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 5px 10px rgba(31, 111, 235, 0.3);
      transition: all 0.3s ease, transform 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .button:hover {
      background: var(--button-hover-color);
      transform: translateY(-3px);
    }
    .button i {
      font-size: 20px;
    }
    .rest-iframe {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
      background: #000;
    }
    .rest-iframe iframe {
      width: 100%;
      height: 600px;
      border: none;
      display: block;
    }
    .channels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 10px;
    }
    .channel-card {
      background: rgba(31, 111, 235, 0.2);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }
    .channel-card:hover {
      background: rgba(255, 153, 0, 0.8);
    }
    .channel-card h3 {
      margin: 10px 0;
      color: var(--primary-color);
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    footer {
      margin-top: auto;
      text-align: center;
      background: rgba(13, 17, 23, 0.95);
      padding: 15px;
      font-size: 14px;
      color: var(--text-color);
    }
    footer a {
      color: var(--primary-color);
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
    #adminSection {
      background: #1a1a1a;
      padding: 40px;
      border-radius: 10px;
    }
    #adminSection h1 {
      color: var(--primary-color);
    }
    .admin-section {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .admin-section h2 {
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    #channelList .channel-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
    }
    #channelList .channel-card button {
      margin-left: 10px;
    }
    #channelSearch, #filterCategory {
      width: 48%;
      padding: 10px;
      margin: 10px 1%;
      border-radius: 5px;
      border: none;
    }
    #adminLogin {
      text-align: center;
      padding: 20px;
    }
    #adminLogin input, #adminControls input, #adminControls select {
      width: 45%;
      margin: 10px 2.5%;
      padding: 10px;
      border-radius: 5px;
      border: none;
    }
    #adminControls button {
      margin: 10px auto;
    }
    @media (max-width: 768px) {
      .iframe-container iframe,
      .rest-iframe iframe,
      .panorama-container {
        height: 400px; 
      }
      .custom-buttons .button {
        padding: 10px 20px;
        font-size: 14px;
      }
      #homeSection h1 {
        font-size: 24px;
      }
    }
    @media (max-width: 600px) {
      nav ul {
        position: absolute;
        top: 60px;
        right: 20px;
        background: rgba(13, 17, 23, 0.95);
        flex-direction: column;
        gap: 0;
        border-radius: 8px;
        padding: 0;
        max-height: 0;
        overflow: hidden;
      }
      nav ul li {
        width: 100%;
      }
      nav ul li a {
        display: block;
        padding: 10px 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .menu-toggle {
        display: block;
      }
      nav ul.show {
        max-height: 500px; 
        transition: max-height 0.5s ease;
      }
    }
    ::-webkit-scrollbar-thumb {background: #002e70;}
    ::-webkit-scrollbar {width:5px; height:9px; background:#dcdcdc;}
    body {margin: 0;}
    td, th {padding: 0;}
    *, *:before, *:after {
      box-sizing: border-box;
    }
    .container {
      margin-left: auto;
      margin-right: auto;
      padding-right: 15px;
      padding-left: 15px;
    }
    @media (min-width: 768px) {
      .container {width: 750px;}
    }
    @media (min-width: 992px) {
      .container {width: 970px;}
    }
    @media (min-width: 1200px) {
      .container {width: 1170px;}
    }
    .container-fluid {
      margin-left: auto;
      margin-right: auto;
      padding-right: 15px;
      padding-left: 15px;
    }
    .container:before, .container:after,
    .container-fluid:before, .container-fluid:after {
      content: " ";
      display: table;
    }
    .container:after, .container-fluid:after {
      clear: both;
    }
    .contents.widget-content {
      padding: 15px;
    }
    div#match_today h2 {
      text-align: center;
      padding: 10px;
      background: #532855;
      color: #fff;
      margin-top: 0;
    }
    .mnajiri {
      display: block;
      height: 157px;
      position: relative;
      box-shadow: rgba(0, 0, 0, 0.57) 0px 25px 20px -21px;
      transition: box-shadow .3s;
      border-radius: 5px;
      margin: 12px auto;
      background: #DCEDC8;
    }
    .fullink {
      display: block;
      height: 100%;
      position: absolute;
      right: 0;
      width: 100%;
      z-index: 5;
    }
    .mnajiriin {
      margin: 0 5px;
    }
    .mnajiri img {
      position: relative;
      display: block;
      margin: 5px auto;
      background: transparent;
      border: 0;
      padding: 0;
      height: 50px;
      width: 50px;
      border-radius: 50%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1),0 2px 5px -1px rgba(0,0,0,0.2);
      transition: box-shadow .3s;
    }
    .mpart1 {
      position: relative;
      height: 48px;
      line-height: 48px;
    }
    .mpart1 strong {
      color: #fff;
      height: 36px;
      margin-right: -30px;
      position: absolute;
      right: 50%;
      text-align: center;
      width: 60px;
      z-index: 1;
      border-radius: 5px;
      top: 30px;
      line-height: 36px;
    }
    .mpart1 span {
      float: right;
      text-align: center;
      width: 100%;
      z-index: 2;
    }
    .right_match {
      float: right;
      padding-left: 20px;
      width: 50%;
      position: relative;
      z-index: 2;
    }
    .left_match {
      float: left;
      padding-right: 20px;
      width: 50%;
      position: relative;
      z-index: 2;
    }
    .details_match {
      padding: 0 25px;
      font-size: 12px;
    }
    .details_match i {
      margin-left: 5px;
    }
    .details_match span {
      background-color: #532855;
      border-left: 1px solid #fff;
      color: #fff;
      float: right;
      height: 36px;
      line-height: 36px;
      position: relative;
      text-align: center;
      width: 33.3%;
    }
    .details_match .liga_mdw { border: 0 none; }
    .first_match::before, .liga_mdw::before {
      background-color: #532855;
      content: "";
      height: 36px;
      position: absolute;
      top: 0;
      width: 20px;
    }
    .first_match::before {
      transform: skew(-20deg);
      right: -12px;
      border-radius: 0 0 8px;
    }
    .liga_mdw::before {
      transform: skew(20deg);
      left: -12px;
      border-radius: 0 0 0 8px;
    }
    @media screen and (max-width:700px) {
      .liga_mdw { display: none; }
      .details_match { padding: 0 60px; }
      .details_match span { width: 50%; }
      .thany::before {
        background-color: #532855;
        content: "";
        height: 36px;
        position: absolute;
        top: 0;
        width: 20px;
        transform: skew(20deg);
        left: -12px;
        border-radius: 0 0 0 8px;
      }
    }
    @media screen and (max-width:500px) {
      .gadwal {
        font-size: 14px;
        width: 106%;
        background: #fff;
      }
    }
    .najiri1 { background-color: #532855; }
    .najiri2 { background-color: #E91E63; }
    .najiri3 { background-color: #4caf50; }
  </style>
</head>
<body>
  <nav>
    <div class="logo">
      <i class="fas fa-globe"></i>
      MCRN 360
    </div>
    <button class="menu-toggle" id="toggleMenuBtn">
      <i class="fas fa-bars"></i>
    </button>
    <ul id="navList">
      <li><a href="#" id="linkHome" class="active">الرئيسية</a></li>
      <li><a href="#" id="linkAllChannels">القنوات العامة</a></li>
      <li><a href="#" id="linkNewsChannels">القنوات الإخبارية</a></li>
      <li><a href="#" id="linkSportsChannels">القنوات الرياضية</a></li>
      <li><a href="#" id="linkChildrenChannels">قنوات الأطفال</a></li>
      <li><a href="#" id="link360">مشاهدة 360</a></li>
      <li><a href="#" id="linkRest">الاستراحة</a></li>
      <li><a href="#" id="linkMatches">جدول المباريات</a></li>
      <li><a href="#" id="linkAbout">عن المطور</a></li>
      <li><a href="#" id="linkAdmin">لوحة التحكم</a></li>
    </ul>
  </nav>
  <div id="homeSection" class="section active">
    <h1>مرحبًا بك في منصة MCRN 360 للبث المباشر!</h1>
    <div class="video-container" id="videoContainer">
      <video
        id="videoPlayer"
        class="video-js vjs-big-play-centered"
        controls
        preload="auto"
        muted
        playsinline
        poster="https://via.placeholder.com/1200x600/000000/FFFFFF/?text=MCRN+LIVE"
      >
        <source src="" type="video/mp4" />
        متصفحك لا يدعم تشغيل الفيديو.
      </video>
    </div>
    <div class="iframe-container" id="iframeContainer">
      <iframe 
        src=""
        scrolling="auto"
        allowfullscreen="true"
      ></iframe>
    </div>
    <div class="custom-buttons" id="videoControls">
      <button class="button" id="rewindBtn">
        <i class="fas fa-backward"></i> إرجاع 10 ثوانٍ
      </button>
      <button class="button" id="playPauseBtn">
        <i class="fas fa-play"></i> تشغيل/إيقاف
      </button>
      <button class="button" id="forwardBtn">
        <i class="fas fa-forward"></i> تقديم 10 ثوانٍ
      </button>
    </div>
    <h2 style="margin-top: 40px;">اختر قناة البث:</h2>
    <div class="custom-buttons" id="channelButtons"></div>
  </div>
  <div id="allChannelsSection" class="section">
    <h1>القنوات العامة</h1>
    <div class="channels-grid" id="allChannelsGrid"></div>
  </div>
  <div id="newsChannelsSection" class="section">
    <h1>القنوات الإخبارية</h1>
    <div class="channels-grid" id="newsChannelsGrid"></div>
  </div>
  <div id="sportsChannelsSection" class="section">
    <h1>القنوات الرياضية</h1>
    <div class="channels-grid" id="sportsChannelsGrid"></div>
  </div>
  <div id="childrenChannelsSection" class="section">
    <h1>قنوات الأطفال</h1>
    <div class="channels-grid" id="childrenChannelsGrid"></div>
  </div>
  <div id="link360Section" class="section">
    <h1>استمتع بتقنية العرض بزاوية 360°</h1>
    <p>منصة MCRN 360 تتيح لك تجربة فريدة تحاكي منصات كبرى مثل الجزيرة 360، حيث يمكنك التحرك داخل الفيديو أو الصورة البانورامية بسهولة ومرونة.</p>
    <div class="panorama-container" id="panoramaContainer"></div>
  </div>
  <div id="restSection" class="section">
    <h1>استمتع بوقتك في صفحة الاستراحة</h1>
    <div class="rest-iframe">
      <iframe
        src="https://www.technomaster.pro/emby/web/index.html"
        scrolling="auto"
        allowfullscreen="true"
      ></iframe>
    </div>
  </div>
  <div id="matchesSection" class="section">
    <h1 style="margin-bottom: 20px;">جدول المباريات</h1>
    <div class="match_today container" id="match_today">
      <h2>مباريات اليوم</h2>
      <div class="widget-content contents">
        <div class="mnajiri">
          <a class="fullink" href="#"></a>
          <div class="mnajiriin">
            <div class="mpart1">
              <div class="right_match">
                <span class="right_tech">
                  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjdE9g2MJ59sJG6nADrdhz_E_ucMJUsyoR4t0UuJlo4l3s15ZigYnKRKUxCfGXch4RG9H8mqGNNZVDQkxMDm-xXFNBAlk_LJWObJOzefa_CbbjL2Uv-JSqDlf75WKSgGwzbVgXuXh8KdRg/s1600/a.png">
                  <div class="fname">برشلونة</div>
                </span>
              </div>
              <strong class="najiri1">19:00</strong>
              <div class="left_match">
                <span class="left_tech">
                  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiUECVpmyDHP41Cqo8L0tBx5OYFuLpaLT6kpowkisOFpYSPoxalLPyS0WSvhf1HhHCxvltDms44d3mmaDQaPi8KRiVux6Brfzza7noO384zlbBjRNrHSH19xkrWvflRd-UaHoIJChtCPto/s1600/u.png">
                  <div class="fname">ريال مدريد</div>
                </span>
              </div>
            </div>
            <div class="details_match">
              <span class="first_match">
                <i aria-hidden="true" class="fa fa-clock-o"></i>
                <b>غرينتش</b>
              </span>
              <span class="thany">
                <i aria-hidden="true" class="fa fa-futbol-o"></i>
                <b>دوري أبطال أوروبا</b>
              </span>
              <span class="liga_mdw">
                <i aria-hidden="true" class="fa fa-desktop"></i>
                <b>Bein Sport HD1</b>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="aboutSection" class="section">
    <h1>عن المطور</h1>
    <p>
      <i class="fa-solid fa-robot" style="color: var(--hover-color);"></i>
      تم تطوير هذه المنصة باستخدام أحدث تقنيات <strong>الذكاء</strong> والترتيب والتنسيق الذكي، 
      لتحقيق تجربة بث مميزة تلبي احتياجات المشاهدين وتمنحهم تجربة 360 فريدة.
    </p>
    <p>
      <i class="fa-solid fa-user-graduate" style="color: var(--hover-color);"></i>
      تم تصميم هذه المنصة بواسطة <strong>المهندس خالد النظاري</strong> 
      الذي يسعى لإطلاق منصات متطورة وذكية بمواصفات عالية تواكب عصر التكنولوجيا الحديثة، 
      لتكون منافسة في تصميمها لمنصات كبرى مثل الجزيرة 360.
    </p>
    <p>جميع الحقوق محفوظة 2026 MCRN 360.</p>
  </div>
  <div id="adminSection" class="section">
    <h1>لوحة التحكم الإدارية</h1>
    <div class="control-panel">
      <!-- تسجيل الدخول -->
      <div id="adminLogin" style="display: none;">
        <input type="password" id="adminPassword" placeholder="أدخل كلمة المرور">
        <label><input type="checkbox" id="rememberMe"> تذكرني</label>
        <button class="button" id="loginBtn"><i class="fas fa-sign-in-alt"></i> تسجيل الدخول</button>
      </div>

      <!-- لوحة الإدارة الرئيسية -->
      <div id="adminControls" style="display: none;">
        <!-- إضافة قناة -->
        <div class="admin-section">
          <h2>إضافة قناة جديدة</h2>
          <input type="text" id="channelName" placeholder="اسم القناة" required>
          <input type="url" id="channelSrc" placeholder="رابط البث (URL)" required>
          <select id="channelType">
            <option value="video">فيديو (Video.js)</option>
            <option value="iframe">إطار (Iframe)</option>
          </select>
          <select id="channelCategory">
            <option value="general">عام</option>
            <option value="news">إخباري</option>
            <option value="sports">رياضي</option>
            <option value="children">أطفال</option>
            <option value="documentary">وثائقي</option>
          </select>
          <button class="button" id="addChannelBtn"><i class="fas fa-plus"></i> إضافة القناة</button>
        </div>

        <!-- إدارة القنوات -->
        <div class="admin-section">
          <h2>إدارة القنوات الحالية</h2>
          <input type="text" id="channelSearch" placeholder="ابحث عن قناة...">
          <select id="filterCategory">
            <option value="">جميع الفئات</option>
            <option value="general">عام</option>
            <option value="news">إخباري</option>
            <option value="sports">رياضي</option>
            <option value="children">أطفال</option>
            <option value="documentary">وثائقي</option>
          </select>
          <div id="channelList" class="channels-grid"></div>
        </div>

        <!-- إدارة الأقسام -->
        <div class="admin-section">
          <h2>إدارة الأقسام</h2>
          <select id="sectionControl">
            <option value="homeSection">الرئيسية</option>
            <option value="allChannelsSection">القنوات العامة</option>
            <option value="newsChannelsSection">القنوات الإخبارية</option>
            <option value="sportsChannelsSection">القنوات الرياضية</option>
            <option value="childrenChannelsSection">قنوات الأطفال</option>
            <option value="link360Section">مشاهدة 360</option>
            <option value="restSection">الاستراحة</option>
            <option value="matchesSection">جدول المباريات</option>
            <option value="aboutSection">عن المطور</option>
          </select>
          <button class="button" id="toggleSectionBtn"><i class="fas fa-eye-slash"></i> إخفاء/إظهار</button>
        </div>

        <!-- إحصائيات سريعة -->
        <div class="admin-section">
          <h2>إحصائيات سريعة</h2>
          <p id="totalChannels">إجمالي القنوات: 0</p>
          <p id="mostWatched">القناة الأكثر مشاهدة: غير متوفر</p>
        </div>

        <!-- تسجيل الخروج -->
        <button class="button" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
      </div>
    </div>
  </div>
  <footer>
    <p>
      © 2026 MCRN 360. جميع الحقوق محفوظة.
      <a href="#">المهندس خالد النظاري</a>.
    </p>
  </footer>
  <script src="https://vjs.zencdn.net/8.5.2/video.min.js"></script>
  <script>
    // تهيئة مشغل الفيديو
    const player = videojs('videoPlayer', {
      fluid: true,
      responsive: true,
      playbackRates: [0.5, 1, 1.5, 2],
    });

    // تخزين تفضيلات المستخدم
    const userPrefs = {
      favoriteChannel: localStorage.getItem('favoriteChannel') || 15,
      lastWatched: localStorage.getItem('lastWatched') || null,
    };

    // قائمة القنوات مع بيانات إضافية
    let channelsData = JSON.parse(localStorage.getItem('channelsData')) || {
      1: { type: 'video', src: 'https://vjs.zencdn.net/v/oceans.mp4', category: 'general', name: 'القناة 1' },
      2: { type: 'iframe', src: 'https://egyliive.online/albaplayer/on-1/?serv=0', category: 'sports', name: 'ON TV' },
      3: { type: 'iframe', src: 'https://www.elahmad.com/tv/gin.php?id=atv-tv', category: 'children', name: 'CN بالعربية' },
      4: { type: 'iframe', src: 'https://www.elahmad.com/tv/live/shahid_shaka.php?id=mbc1', category: 'general', name: 'ATV' },
      5: { type: 'iframe', src: 'https://www.elahmad.com/tv/live/shahid_shaka.php?id=natgeoad', category: 'documentary', name: 'Nat Geo' },
      6: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=mbc3_tv_1', category: 'children', name: 'MBC3' },
      7: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=rotana_aflam', category: 'general', name: 'روتانا أفلام' },
      8: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=rotana_cinema', category: 'general', name: 'روتانا سينما' },
      9: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=yemen_shabab', category: 'news', name: 'يمن شباب' },
      10: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=mbc_masr_usa', category: 'general', name: 'MBC مصر' },
      11: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=mbc2_tv_1', category: 'general', name: 'MBC 2' },
      12: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=mbcmasr2_tv_1', category: 'general', name: 'MBC مصر 2' },
      13: { type: 'iframe', src: 'https://vk.com/video_ext.php?oid=772742295&id=456246865&autoplay=1', category: 'general', name: 'البث الجديد' },
      14: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=almahriah_tv', category: 'news', name: 'المهريه' },
      15: { type: 'iframe', src: 'https://www.elahmad.com/tv/radiant.php?id=alsaeedahtv', category: 'general', name: 'السعيدة' },
      16: { type: 'iframe', src: 'https://www.elahmad.com/tv/mobiletv/glarb.php?id=belqees_tv', category: 'general', name: 'بلقيس' },
    };

    // عناصر DOM
    const videoContainer = document.getElementById('videoContainer');
    const iframeContainer = document.getElementById('iframeContainer');
    const iframeElement = iframeContainer.querySelector('iframe');
    const videoControls = document.getElementById('videoControls');
    const channelButtons = document.getElementById('channelButtons');
    const sections = {
      'homeSection': document.getElementById('homeSection'),
      'allChannelsSection': document.getElementById('allChannelsSection'),
      'newsChannelsSection': document.getElementById('newsChannelsSection'),
      'sportsChannelsSection': document.getElementById('sportsChannelsSection'),
      'childrenChannelsSection': document.getElementById('childrenChannelsSection'),
      'link360Section': document.getElementById('link360Section'),
      'restSection': document.getElementById('restSection'),
      'matchesSection': document.getElementById('matchesSection'),
      'aboutSection': document.getElementById('aboutSection'),
      'adminSection': document.getElementById('adminSection'),
    };

    // إعدادات لوحة التحكم
    const adminPassword = '77177';
    let isAdminLoggedIn = localStorage.getItem('adminSession') === 'active';

    // تحميل القناة
    function loadChannel(channelNum) {
      const channel = channelsData[channelNum] || channelsData[1];
      if (channel.type === 'video') {
        videoContainer.style.display = 'block';
        iframeContainer.style.display = 'none';
        videoControls.style.display = 'flex';
        player.src({ src: channel.src, type: 'video/mp4' });
        player.play().catch(err => handleError(err, channelNum));
      } else {
        videoContainer.style.display = 'none';
        iframeContainer.style.display = 'block';
        videoControls.style.display = 'none';
        iframeElement.src = channel.src;
      }
      localStorage.setItem('lastWatched', channelNum);
      recommendChannels(channel.category);
    }

    // التعامل مع الأخطاء
    function handleError(err, channelNum) {
      console.warn(`خطأ في تشغيل القناة ${channelNum}:`, err);
      alert('حدث خطأ في تحميل البث، جاري المحاولة مع قناة أخرى...');
      loadChannel(1);
    }

    // التوصيات الذكية
    function recommendChannels(category) {
      const recommended = Object.keys(channelsData)
        .filter(num => channelsData[num].category === category && num != localStorage.getItem('lastWatched'))
        .slice(0, 3);
      console.log(`قنوات مقترحة (${category}):`, recommended.map(num => channelsData[num].name));
    }

    // عرض القنوات ديناميكيًا
    function renderChannels() {
      channelButtons.innerHTML = '';
      Object.keys(channelsData).forEach(num => {
        const btn = document.createElement('button');
        btn.className = 'button';
        btn.setAttribute('data-channel', num);
        btn.innerHTML = `<i class="fas fa-${channelsData[num].category === 'sports' ? 'futbol' : 'tv'}"></i> ${channelsData[num].name}`;
        channelButtons.appendChild(btn);
      });

      ['allChannelsGrid', 'newsChannelsGrid', 'sportsChannelsGrid', 'childrenChannelsGrid'].forEach(gridId => {
        const grid = document.getElementById(gridId);
        grid.innerHTML = '';
        const category = gridId === 'allChannelsGrid' ? 'general' : gridId === 'newsChannelsGrid' ? 'news' : gridId === 'sportsChannelsGrid' ? 'sports' : 'children';
        Object.keys(channelsData).forEach(num => {
          if (channelsData[num].category === category) {
            const card = document.createElement('div');
            card.className = 'channel-card';
            card.setAttribute('data-channel', num);
            card.innerHTML = `
              <h3><i class="fas fa-${category === 'sports' ? 'futbol' : 'tv'}"></i> ${channelsData[num].name}</h3>
              <button class="button watch-btn" data-channel="${num}">مشاهدة</button>
            `;
            grid.appendChild(card);
          }
        });
      });
    }

    // التحكم في الفيديو
    document.getElementById('rewindBtn').addEventListener('click', () => {
      player.currentTime(Math.max(player.currentTime() - 10, 0));
    });
    document.getElementById('playPauseBtn').addEventListener('click', () => {
      if (player.paused()) player.play().catch(err => console.warn('تعذر التشغيل:', err));
      else player.pause();
    });
    document.getElementById('forwardBtn').addEventListener('click', () => {
      player.currentTime(player.currentTime() + 10);
    });

    // التحكم الصوتي
    if ('webkitSpeechRecognition' in window) {
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'ar';
      recognition.continuous = false;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const command = event.results[0][0].transcript.toLowerCase();
        console.log('الأمر الصوتي:', command);
        if (command.includes('الرئيسية')) showSection('homeSection', 'linkHome');
        else if (command.includes('رياضة')) showSection('sportsChannelsSection', 'linkSportsChannels');
        else if (command.includes('أطفال')) showSection('childrenChannelsSection', 'linkChildrenChannels');
        else if (command.includes('تشغيل')) player.play();
        else if (command.includes('إيقاف')) player.pause();
        else if (command.match(/قناة (\d+)/)) {
          const channelNum = parseInt(command.match(/قناة (\d+)/)[1]);
          if (channelsData[channelNum]) {
            showSection('homeSection', 'linkHome');
            loadChannel(channelNum);
          }
        }
      };

      document.addEventListener('keydown', (e) => {
        if (e.key === 'v') recognition.start();
      });
    }

    // تبديل القنوات عند النقر
    document.addEventListener('click', (e) => {
      if (e.target.matches('[data-channel]') || e.target.closest('[data-channel]')) {
        const channelNum = parseInt(e.target.getAttribute('data-channel') || e.target.closest('[data-channel]').getAttribute('data-channel'));
        showSection('homeSection', 'linkHome');
        loadChannel(channelNum);
      }
    });

    // إدارة الأقسام
    function showSection(sectionId, linkId) {
      Object.values(sections).forEach(section => section.classList.remove('active'));
      sections[sectionId].classList.add('active');
      document.querySelectorAll('nav ul li a').forEach(a => a.classList.remove('active'));
      if (linkId) document.getElementById(linkId).classList.add('active');
      if (window.innerWidth <= 600) document.getElementById('navList').classList.remove('show');
    }

    // ربط الروابط بالأقسام
    ['linkHome', 'linkAllChannels', 'linkNewsChannels', 'linkSportsChannels', 'linkChildrenChannels', 'link360', 'linkRest', 'linkMatches', 'linkAbout', 'linkAdmin'].forEach(id => {
      document.getElementById(id).addEventListener('click', (e) => {
        e.preventDefault();
        if (id === 'linkAdmin') {
          showSection('adminSection', 'linkAdmin');
          if (isAdminLoggedIn) renderAdminPanel();
        } else {
          showSection(id.replace('link', '').toLowerCase() + 'Section', id);
        }
      });
    });

    // قائمة التنقل في الجوال
    document.getElementById('toggleMenuBtn').addEventListener('click', () => {
      document.getElementById('navList').classList.toggle('show');
    });

    // تهيئة العرض البانورامي
    let panorama, viewer;
    function initPanorama() {
      const container = document.getElementById('panoramaContainer');
      panorama = new PANOLENS.ImagePanorama('https://www.elahmad.com/tv/kanal-turk.php');
      viewer = new PANOLENS.Viewer({ container, autoHideInfospot: false });
      viewer.add(panorama);
    }

    // التحقق من تسجيل الدخول عند التحميل
    window.addEventListener('load', () => {
      const adminLogin = document.getElementById('adminLogin');
      const adminControls = document.getElementById('adminControls');
      if (isAdminLoggedIn) {
        adminLogin.style.display = 'none';
        adminControls.style.display = 'block';
        renderAdminPanel();
      } else {
        adminLogin.style.display = 'block';
        adminControls.style.display = 'none';
      }
      const now = new Date().getHours();
      const defaultChannel = now >= 18 ? 2 : userPrefs.favoriteChannel;
      loadChannel(defaultChannel);
      renderChannels();
      initPanorama();
    });

    // تسجيل الدخول
    document.getElementById('loginBtn').addEventListener('click', () => {
      const password = document.getElementById('adminPassword').value;
      const rememberMe = document.getElementById('rememberMe').checked;
      if (password === adminPassword) {
        isAdminLoggedIn = true;
        if (rememberMe) localStorage.setItem('adminSession', 'active');
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminControls').style.display = 'block';
        renderAdminPanel();
      } else {
        alert('كلمة المرور غير صحيحة!');
      }
    });

    // تسجيل الخروج
    document.getElementById('logoutBtn').addEventListener('click', () => {
      isAdminLoggedIn = false;
      localStorage.removeItem('adminSession');
      document.getElementById('adminLogin').style.display = 'block';
      document.getElementById('adminControls').style.display = 'none';
    });

    // عرض لوحة التحكم
    function renderAdminPanel() {
      const channelList = document.getElementById('channelList');
      channelList.innerHTML = '';
      Object.keys(channelsData).forEach(num => {
        const channel = channelsData[num];
        const card = document.createElement('div');
        card.className = 'channel-card';
        card.innerHTML = `
          <span>${channel.name} (${channel.category}) - ${channel.src}</span>
          <div>
            <button class="button" onclick="editChannel(${num})"><i class="fas fa-edit"></i> تعديل</button>
            <button class="button" onclick="deleteChannel(${num})"><i class="fas fa-trash"></i> حذف</button>
          </div>
        `;
        channelList.appendChild(card);
      });
      updateStats();
    }

    // تحديث الإحصائيات
    function updateStats() {
      const total = Object.keys(channelsData).length;
      document.getElementById('totalChannels').textContent = `إجمالي القنوات: ${total}`;
      const lastWatched = channelsData[localStorage.getItem('lastWatched')];
      document.getElementById('mostWatched').textContent = `القناة الأكثر مشاهدة: ${lastWatched ? lastWatched.name : 'غير متوفر'}`;
    }

    // إضافة قناة جديدة
    document.getElementById('addChannelBtn').addEventListener('click', () => {
      const name = document.getElementById('channelName').value.trim();
      const src = document.getElementById('channelSrc').value.trim();
      const type = document.getElementById('channelType').value;
      const category = document.getElementById('channelCategory').value;

      if (!name || !src) {
        alert('يرجى ملء جميع الحقول!');
        return;
      }
      if (!isValidUrl(src)) {
        alert('رابط البث غير صالح! يرجى إدخال رابط URL صحيح.');
        return;
      }

      const newChannelNum = Math.max(...Object.keys(channelsData).map(Number)) + 1;
      channelsData[newChannelNum] = { type, src, category, name };
      localStorage.setItem('channelsData', JSON.stringify(channelsData));
      renderChannels();
      renderAdminPanel();
      alert(`تم إضافة القناة "${name}" بنجاح!`);
      document.getElementById('channelName').value = '';
      document.getElementById('channelSrc').value = '';
    });

    // التحقق من صلاحية URL
    function isValidUrl(string) {
      try {
        new URL(string);
        return true;
      } catch (_) {
        return false;
      }
    }

    // تعديل قناة
    window.editChannel = function(channelNum) {
      const channel = channelsData[channelNum];
      const newName = prompt('أدخل الاسم الجديد للقناة:', channel.name);
      const newSrc = prompt('أدخل رابط البث الجديد:', channel.src);
      const newType = prompt('أدخل نوع البث (video/iframe):', channel.type);
      const newCategory = prompt('أدخل الفئة (general/news/sports/children/documentary):', channel.category);

      if (newName && newSrc && newType && newCategory) {
        if (!isValidUrl(newSrc)) {
          alert('رابط البث غير صالح!');
          return;
        }
        if (!['video', 'iframe'].includes(newType)) {
          alert('نوع البث يجب أن يكون "video" أو "iframe"!');
          return;
        }
        if (!['general', 'news', 'sports', 'children', 'documentary'].includes(newCategory)) {
          alert('فئة غير صالحة!');
          return;
        }

        channelsData[channelNum] = {
          name: newName,
          src: newSrc,
          type: newType,
          category: newCategory
        };
        localStorage.setItem('channelsData', JSON.stringify(channelsData));
        renderChannels();
        renderAdminPanel();
        alert('تم تعديل القناة بنجاح!');
      }
    };

    // حذف قناة
    window.deleteChannel = function(channelNum) {
      if (confirm(`هل تريد حذف القناة "${channelsData[channelNum].name}"؟`)) {
        delete channelsData[channelNum];
        localStorage.setItem('channelsData', JSON.stringify(channelsData));
        renderChannels();
        renderAdminPanel();
        alert('تم حذف القناة بنجاح!');
      }
    };

    // البحث والتصفية
    document.getElementById('channelSearch').addEventListener('input', filterChannels);
    document.getElementById('filterCategory').addEventListener('change', filterChannels);

    function filterChannels() {
      const searchTerm = document.getElementById('channelSearch').value.toLowerCase();
      const categoryFilter = document.getElementById('filterCategory').value;
      const channelList = document.getElementById('channelList');
      channelList.innerHTML = '';

      Object.keys(channelsData).forEach(num => {
        const channel = channelsData[num];
        const matchesSearch = channel.name.toLowerCase().includes(searchTerm) || channel.src.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || channel.category === categoryFilter;

        if (matchesSearch && matchesCategory) {
          const card = document.createElement('div');
          card.className = 'channel-card';
          card.innerHTML = `
            <span>${channel.name} (${channel.category}) - ${channel.src}</span>
            <div>
              <button class="button" onclick="editChannel(${num})"><i class="fas fa-edit"></i> تعديل</button>
              <button class="button" onclick="deleteChannel(${num})"><i class="fas fa-trash"></i> حذف</button>
            </div>
          `;
          channelList.appendChild(card);
        }
      });
    }

    // إدارة الأقسام
    document.getElementById('toggleSectionBtn').addEventListener('click', () => {
      const sectionId = document.getElementById('sectionControl').value;
      const section = sections[sectionId];
      const isHidden = section.style.display === 'none';
      section.style.display = isHidden ? 'block' : 'none';
      alert(`تم ${isHidden ? 'إظهار' : 'إخفاء'} القسم: ${sectionId}`);
    });
  </script>
</body>
</html>